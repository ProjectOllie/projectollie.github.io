var News=new function(){this.updateGuideRatings=function(){$(".sidebar-featured-guides-rating").each(function(){var a=$(this);a.empty().append(GetStars(a.attr("data-rating")))})};this.updateTodayInLegion=function(c){$(".tiw-region").each(function(){this.setAttribute("data-columns",$("> .tiw-region-row > .tiw-group-wrapper",this).length)});var k=function(q){for(var j=0,r;r=c[j];j++){if(r[0]==q){return{id:r[0],name:r[1]}}}return{id:"??",name:LANG.unknown}};var n=$WH.ge("today-in-wow-wq-link");var g=(function(u,t){$WH.localStorage.set("today-in-wow",t);var v=k(t);for(var r=0,i=document.getElementsByClassName("tiw-chooser"),s;s=i[r];r++){s.innerHTML=v.name+' <span class="fa fa-chevron-down"></span>'}$(".tiw-region.tiw-show").removeClass("tiw-show");$(".tiw-region-"+t).addClass("tiw-show");if(u){var q="/world-quests";switch(t){case"US":q+="/na";break;case"EU":q+="/"+t.toLowerCase();break}u.href=q}}).bind(null,n);var m=function(r,i,j){var t=$(j);var s=parseInt(t.data("timestamp"),10)-Math.floor((Date.now()-r)/1000);if(s>0){var q="";if(s<600){q=" q10"}else{if(s<1800){q=" r1"}else{if(s<3600){q=" r2"}else{if(s<10800){q=" r3"}}}}t.html("<b>"+LANG.dailyquestreset+'</b>&nbsp; <span class="icon-both'+q+'">'+g_formatTimeElapsed(s)+"</span>")}else{t.hide()}};for(var e=0,b=document.getElementsByClassName("tiw-chooser"),o;o=b[e];e++){var l=[];for(var f=0,p;p=c[f];f++){l.push([f,p[1],g.bind(null,p[0])])}o.menu=l;Menu.add(o,o.menu)}var d=$WH.localStorage.get("today-in-wow")||"US";if(d=="Oceanic"){d="US"}g(d);$("#today-in-wow-show-all").click(function(){$(".today-in-wow").addClass("show-all")});var a=Date.now()-g_serverTime.getTime();var h=function(){$(".tiw-timer").each(m.bind(null,a))};h();window.setInterval(h,10000);News.addTodayInWowTracking()};this.addFeatureBoxTracking=function(){if(typeof WAS=="undefined"){return}var a=WAS.getChannelName();$(".row-features .feature-block a").each(function(){$WH.track.addLinkTracking(this,a,"click","news-feature-image")})};this.addNewsPostTracking=function(a){if(!a||typeof WAS=="undefined"){return}var b=WAS.getChannelName();$("a",a).each(function(){$WH.track.addLinkTracking(this,b,"click",News.determineNewsPostLinkArea)})};this.getSubjectFromChild=function(c){var d=$(c).closest(".entry");if(!d.length){return"Unknown"}var b=$(".entry-title-group .heading-size-1",d);if(!b.length){return"Unknown"}var a=$("a",b);if(a.length){return a.html()}return b.html()};this.determineNewsPostLinkArea=function(b){if(b.parentNode&&b.parentNode.className){if(b.parentNode.className.indexOf("heading-size-")>-1&&b.parentNode.parentNode&&b.parentNode.parentNode.className&&b.parentNode.parentNode.className.indexOf("entry-title-group")>-1){return"News - View Article (Heading)"}else{if(b.parentNode.className.indexOf("continue-reading")>-1){return"News - View Article (Continue Reading)"}else{if(b.parentNode.className.indexOf("tags")>-1){return"News - Tag"}else{if(b.parentNode.className.indexOf("share-buttons")>-1){return"News - Share"}else{if(b.parentNode.className.indexOf("entrylinks")>-1){if(b.className){if(b.className.indexOf("fa-link")>-1){return"News - View Article (Permalink)"}else{if(b.className.indexOf("fa-pencil")>-1){return"News - Edit (Text)"}}}}}}}}}if(b.className){var c={"entryh-comments":"News - Comments (Heading Count)","comments-numsm":"News - Comments (Text Count)","comments-btn":"News - Post a Comment","entryh-edit":"News - Edit (Heading)"};for(var a in c){if(b.className.indexOf(a)>-1&&c.hasOwnProperty(a)){return c[a]}}}if(b.getAttribute("rel")=="author"){return"News - Author"}return"News - Link in the body"};this.addTodayInWowTracking=function(){if(typeof WAS=="undefined"){return}var a=WAS.getChannelName();$(".today-in-wow a").each(function(){$WH.track.addLinkTracking(this,a,"click",News.determineTodayInWowLinkArea)})};this.determineTodayInWowLinkArea=function(a){if(a.parentNode&&a.parentNode.nodeName=="B"){return"Today in WoW - Heading"}return"Today in WoW - Link"};this.setupMoveableSidebarComplete=false;this.setupMoveableSidebar=function(){if(News.setupMoveableSidebarComplete){return}if(!g_user.premium){return}var g=$WH.ce("span");g.className="sidebar-movecontrols sidebar-movecontrols-up fa fa-caret-up";var f=$WH.ce("span");f.className="sidebar-movecontrols sidebar-movecontrols-dn fa fa-caret-down";var j=document.getElementsByClassName("sidebar-moveable");var b=j.length?j[0].parentNode:false;for(var k=0;k<j.length;k++){$(j[k]).addClass("sidebar-moveable-forsaving");var d=g.cloneNode(true);var e=f.cloneNode(true);$WH.ae(j[k],d);$WH.aE(d,"click",News.moveSidebarBlock);$WH.ae(j[k],e);$WH.aE(e,"click",News.moveSidebarBlock)}var a=[];if(a=$WH.localStorage.get("moveable-sidebar")){a=JSON.parse(a);var c,h,i;while(a.length>1){i=a.shift();c=$WH.ge(i);if(!c){if(!b){continue}c=$WH.ce("div");c.id=i;c.style.display="none";c.className="sidebar-moveable sidebar-moveable-forsaving sidebar-moveable-hidelater";d=g.cloneNode(true);$WH.ae(c,d);$WH.aE(d,"click",News.moveSidebarBlock);$WH.ae(b,c)}h=0;j=c.parentNode.getElementsByClassName("sidebar-moveable");for(var k=0;k<j.length;k++){if(j[k]==c){break}if($WH.in_array(a,j[k].id)!=-1){h++}}if(h>0){g=c.getElementsByClassName("sidebar-movecontrols-up")[0];while(h--){g.click()}}}$(".sidebar-moveable-hidelater").removeClass("sidebar-moveable sidebar-moveable-hidelater").empty()}News.setupMoveableSidebarComplete=true};this.moveSidebarBlock=function(){var b=this.className.indexOf("sidebar-movecontrols-up")>=0?"up":"dn";var c=this.parentNode;var d=c.parentNode.getElementsByClassName("sidebar-moveable");var g=-1;for(var f=0;f<d.length;f++){if(d[f].id==c.id){g=f;break}}if(g==-1){console.log("Could not find moveable block in list of its neighbors!",c);return}if(g==0&&b=="up"){return}if(g==d.length-1&&b=="dn"){return}if(b=="dn"){var i=c.nextSibling;var h=d[g+1];if(News.setupMoveableSidebarComplete){c.style.zIndex="10";h.style.zIndex="9";var e=(c.offsetTop-h.offsetTop);$(c).animate({top:(h.offsetTop+h.offsetHeight-c.offsetTop-c.offsetHeight)+"px"},{complete:function(){c.style.top="0px";c.style.zIndex="0";c.parentNode.insertBefore(c,h.nextSibling);if(i&&(i!=h)){h.parentNode.insertBefore(h,i)}News.saveMoveableSidebarPrefs()}});$(h).animate({top:e+"px"},{complete:function(){h.style.top="0px";h.style.zIndex="0"}})}else{c.parentNode.insertBefore(c,h.nextSibling);if(i&&(i!=h)){h.parentNode.insertBefore(h,i)}}}else{var a=c.previousSibling;var h=d[g-1];if(News.setupMoveableSidebarComplete){c.style.zIndex="10";h.style.zIndex="9";var e=(c.offsetTop+c.offsetHeight-h.offsetTop-h.offsetHeight);$(c).animate({top:(h.offsetTop-c.offsetTop)+"px"},{complete:function(){c.style.top="0px";c.style.zIndex="0";c.parentNode.insertBefore(c,h);if(a&&(a!=h)){h.parentNode.insertBefore(h,a.nextSibling)}News.saveMoveableSidebarPrefs()}});$(h).animate({top:e+"px"},{complete:function(){h.style.top="0px";h.style.zIndex="0"}})}else{c.parentNode.insertBefore(c,h);if(a&&(a!=h)){h.parentNode.insertBefore(h,a.nextSibling)}}}};this.saveMoveableSidebarPrefs=function(){if(!$WH.localStorage.isSupported()){return}var c=document.getElementsByClassName("sidebar-moveable-forsaving");var b=[];for(var a=0;a<c.length;a++){b.push(c[a].id)}b=JSON.stringify(b);$WH.localStorage.set("moveable-sidebar",b)}};$(document).ready(function(){$("#wh-menu").hide();$("#wh-button").click(function(d){d.preventDefault();$("#wh-menu").slideDown("fast")});$("#wh-menu").mouseleave(function(){$(this).slideUp("fast")});var c=-30;var b=0;var a="";$(".v, .s, .date-tip, .class-tip").mouseover(function(h){var g=$(this);var f;if(g.attr("class").indexOf("date-tip")>-1||g.attr("class").indexOf("class-tip")>-1){f=g.attr("title");a=g.attr("title")}else{f=g.text()}g.attr("title","");var d="";switch(g.attr("class")){case"c fa fa-reply":return;break;case"v":d=" views";break;case"s":d=" shares";break}$("body").append('<div id="tooltip">'+f+d+"</div>");$("#tooltip").css("top",h.pageY+c);$("#tooltip").css("left",h.pageX+b);b=-1*($("#tooltip").width()/2);$("#tooltip").show()}).mousemove(function(d){$("#tooltip").css("top",d.pageY+c);$("#tooltip").css("left",d.pageX+b)}).mouseout(function(){var d=$(this);if(d.attr("class").indexOf("date-tip")>-1||d.attr("class").indexOf("class-tip")>-1){d.attr("title",a)}$("body").children("div#tooltip").remove()})});function bl_setPollVoting(){var a=$("#poll-container");a.empty();a.append(bl_createPollVoteTable())}function bl_setPollResults(){var a=$("#poll-container");a.empty();a.append(bl_createPollResultsTable())}function bl_createPollVoteTable(){var d=$("<table/>",{"class":"grid"});var e=$("<tr/>");var f=$("<th/>");f.append($("<span/>",{text:fo_pollData.question}));e.append(f);d.append(e);for(var c=0;c<fo_pollData.options.length;++c){var b=fo_pollData.options[c];e=$("<tr/>");f=$("<td/>");if(fo_pollData.multiple){var a=$("<input/>",{type:"checkbox",name:"polloption"+b[0],id:"polloption"+b[0],value:b[0]})}else{var a=$("<input/>",{type:"radio",name:"polloption",value:b[0],id:"polloption"+b[0],value:b[0]})}f.append(a);f.append($("<label/>",{"for":"polloption"+b[0],text:b[1]}));f.click(function(h){var g=$("input:checkbox, input:radio",h.target);g.prop("checked",g.is(":radio")||!g.is(":checked")?true:false)});e.append(f);d.append(e)}e=$("<tr/>");f=$("<td/>");a=$("<button/>",{text:(!g_user.id?"Sign in to vote":LANG.poll_vote)});a[0].setAttribute("type","button");if(!g_user.id){a.click(function(g){g.preventDefault();window.location="/account=signin?next="+window.location.pathname;return true})}else{a.click(function(k){k.preventDefault();var j=[];if(fo_pollData.multiple){var h=$("input:checkbox:checked",$("#poll-container"))}else{var h=$("input:radio:checked",$("#poll-container"))}for(var g=0;g<h.length;++g){j.push(parseInt(h[g].value,10))}if(j.length>0){$.ajax({url:"/forums=pollvote",type:"POST",data:{poll:g_pageInfo.topic,options:j.join(",")},success:function(m){if(m==1){for(var l=0;l<fo_pollData.options.length;++l){if($WH.isset("fo_pollVotes")&&$.inArray(fo_pollData.options[l][0],fo_pollVotes)!=-1){fo_pollData.options[l][2]--}if($.inArray(fo_pollData.options[l][0],j)!=-1){fo_pollData.options[l][2]++}}fo_pollVotes=j;bl_setPollResults()}else{alert("Error while voting: "+m)}}.bind(this)})}}.bind(this))}f.append(a);f.append($("<a/>",{"class":"button",text:LANG.poll_viewresults,href:"javascript:;",click:bl_setPollResults}));e.append(f);d.append(e);return d}function bl_createPollResultsTable(){var a=["rep0","rep1","rep2","rep3","rep4","rep5","rep6","rep7","ach0"];var j=$("<table/>",{"class":"grid"});var h=$("<tr/>");var c=$("<th/>",{colspan:4});c.append($("<span/>",{text:LANG.poll_pollresults+fo_pollData.question}));h.append(c);j.append(h);var e=0,g=0;for(var d=0;d<fo_pollData.options.length;++d){if(fo_pollData.options[d][2]>g){g=fo_pollData.options[d][2]}e+=fo_pollData.options[d][2]}for(var d=0;d<fo_pollData.options.length;++d){var b=fo_pollData.options[d];h=$("<tr/>");c=$("<td/>",{"class":"pollresultstext",text:b[1]});h.append(c);c=$("<td/>",{id:"pollresultbar"+b[0],width:"100%"});var f=$(g_createProgressBar({width:(g>0?Math.floor((b[2]/g)*100):0),color:a[d%a.length]}));c.append(f);h.append(c);c=$("<td/>",{id:"pollresultpct"+b[0],"class":"pollresultdata",text:(e>0?((b[2]/e)*100).toFixed(1):0)+"% ("+b[2]+")"});h.append(c);if($WH.isset("fo_pollVotes")&&$.inArray(b[0],fo_pollVotes)!=-1){$("td",h).addClass("forums-poll-voted")}j.append(h)}if(!g_user.forumban){h=$("<tr/>");c=$("<td/>",{colspan:4});c.append($("<a/>",{"class":"button",text:LANG.poll_returntovoting,href:"javascript:;",click:bl_setPollVoting}));h.append(c);j.append(h)}return j}function bl_goToNewPost(d,b){var c=document.forms.addcomment;if(this.href=="javascript:;"){if(d==0){location.replace("#comment")}}if(c){var a=$WH.gE(c,"textarea")[0];if(d==1&&b!=null&&b.user!=null&&b.body!=null){a.value+="[quote "+b.user+"]"+b.body+"[/quote]\n\n";g_setCaretPosition(a,a.value.length)}setTimeout((function(){g_safeFocus(this)}).bind(a),25)}}Listview.templates.blogcomment={sort:[],mode:2,nItemsPerPage:-1,hideBands:1|2,poundable:2,noStyle:true,columns:[],compute:function(l,J,H){var f=(g_user.roles&U_GROUP_MODERATOR)!=0,z=f||(g_pageInfo.locked==0&&l.user.toLowerCase()==g_user.name.toLowerCase()&&!g_user.forumban),v=z&&!l.op,L=0,r=g_users[l.user],d=0,g=0,K=0,p=null;if(g_pageInfo.blog&&l.op&&(g_user.roles&U_GROUP_MODERATOR)){z=true}if(r!=null){if(g_customColors[l.user]){p=g_customColors[l.user]}else{if(r.roles&U_GROUP_ADMIN){d=1}else{if(r.roles&(U_GROUP_GREEN_TEXT|U_GROUP_BUREAU)){g=1}else{if(r.roles&(U_GROUP_VIP|U_GROUP_PREMIUM|U_GROUP_EDITOR)){K=1}}}}if(this.blog!=2&&(!g_pageInfo.blog||!l.op)){L=1}}var G=$("<div/>",{"class":"comment"});G.attr("id","p"+l.id);var I=$("<div/>",{"class":"comment-dateline"});if(r!=null&&r.avatar){I.append(Icon.createUser(r.avatar,r.avatarmore,0,null,((r.roles&U_GROUP_PREMIUMISH)?r.border:Icon.STANDARD_BORDER),true,Icon.getPrivilegeBorder(r.reputation)))}var u=$("<var/>");var F=$("<a/>",{href:"/user="+l.user,text:l.user});u.append(F);var t=new Date(l.date),E=(g_serverTime-t)/1000;var e=$("<a/>",{"class":"date-tip",title:g_formatDateSimple(t,1)});e.attr("href","#p"+l.id);g_formatDate(e[0],E,t);u.append(e);var a=$("<small/>",{text:$WH.sprintf(LANG.lvcomment_patch,g_getPatchVersion(t))});u.append(a);I.append(u);var b=$("<em/>");var x=false;if(z){var c=$("<span/>");var y=$("<a/>",{"class":"fa fa-pencil",text:LANG.lvtopic_edit,href:"javascript:;",click:Listview.funcBox.coEdit.bind(this,l,-1,true)});c.append(y);b.append(c)}if(v){var m=$("<span/>");var q=$("<a/>",{"class":"fa fa-times",text:LANG.lvtopic_delete,href:"javascript:;",click:Listview.funcBox.foDelete.bind(this,l)});m.append(q);b.append(m)}if(L){if(l.op&&g_pageInfo){l.sticky=g_pageInfo.sticky}var w=$("<span/>");var j=$("<a/>",{"class":"fa fa-exclamation-triangle",href:"javascript:;",click:ContactTool.show.bind(ContactTool,{mode:2,post:l}),text:LANG.lvcomment_report});g_addTooltip(j[0],LANG.report_tooltip,"q2");w.append(j);b.append(w)}if((g_pageInfo.locked==0&&!g_user.forumban)||f){var A=$("<span/>");var D=$("<a/>",{"class":"fa fa-quote-left",text:LANG.lvtopic_quote});if(g_user.id>0){D.attr("href","javascript:;");D.click(bl_goToNewPost.bind(D[0],1,l))}else{D.attr("href","/account=signin")}A.append(D);b.append(A);var h=$("<span/>");var k=$("<a/>",{"class":"fa fa-reply",text:LANG.lvtopic_reply});if(g_user.id>0){k.attr("href","#comment");k.click(bl_goToNewPost.bind(k[0],1))}else{k.attr("href","/account=signin")}h.append(k);b.append(h)}I.append(b);G.append(I);var o=$("<div/>");if(p){o.addClass("comment-"+p)}else{if(d){o.addClass("comment-blue")}else{if(g){o.addClass("comment-green")}else{if(K){o.addClass("comment-gold")}}}}var B=Markup.CLASS_USER;if(r&&r.roles){B=Markup.rolesToClass(r.roles)}if(g_pageInfo.blog&&l.op&&B!=Markup.CLASS_ADMIN){B=Markup.CLASS_STAFF}o.html(Markup.toHtml(l.body,{allow:B,roles:r?r.roles:null,uid:l.id}));G.append(o);l.divBody=o;var s=$("<div/>");if(l.response){s.html(Markup.toHtml("[div][/div][wowheadresponse="+l.responseuser+" roles="+l.responseroles+"]"+l.response+"[/wowheadresponse]",{allow:Markup.CLASS_STAFF,roles:l.responseroles,uid:"resp-"+l.id}))}G.append(s);l.divResponse=s;if(r==null||!(r.roles&U_GROUP_STAFF)||(g_user.roles&U_GROUP_STAFF)){var C=$("<div/>",{"class":"comment-lastedit",text:LANG.lvtopic_lastedit});l.divLastEdit=C[0];var n=$("<a/>",{text:" "});C.append(n).append(" ").append($("<span/>")).append(" ");G.append(C);Listview.funcBox.coUpdateLastEdit(l)}$(J).append(G)}};
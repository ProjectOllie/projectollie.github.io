if(typeof $WH=="undefined"){var $WH={}}$WH.staticUrl=typeof g_staticUrl=="string"?g_staticUrl:"https://wow.zamimg.com";$WH.$E=function(a){if(!a){if(typeof event!="undefined"){a=event}else{return null}}if(a.which){a._button=a.which}else{a._button=a.button;if($WH.Browser.ie6789&&a._button){if(a._button&4){a._button=2}else{if(a._button&2){a._button=3}}}else{a._button=a.button+1}}a._target=a.target?a.target:a.srcElement;a._wheelDelta=a.wheelDelta?a.wheelDelta:-a.detail;return a};$WH.$A=function(c){var e=[];for(var d=0,b=c.length;d<b;++d){e.push(c[d])}return e};if(!Function.prototype.bind){Function.prototype.bind=function(){var c=this,a=$WH.$A(arguments),b=a.shift();return function(){return c.apply(b,a.concat($WH.$A(arguments)))}}}$WH.bindfunc=function(){args=$WH.$A(arguments);var b=args.shift();var a=args.shift();return function(){return b.apply(a,args.concat($WH.$A(arguments)))}};if(!String.prototype.ltrim){String.prototype.ltrim=function(){return this.replace(/^\s*/,"")}}if(!String.prototype.rtrim){String.prototype.rtrim=function(){return this.replace(/\s*$/,"")}}if(!String.prototype.trim){String.prototype.trim=function(){return this.ltrim().rtrim()}}if(!String.prototype.removeAllWhitespace){String.prototype.removeAllWhitespace=function(){return this.replace("/s+/g","")}}$WH.strcmp=function(d,c){if(d==c){return 0}if(d==null){return -1}if(c==null){return 1}var f=parseFloat(d);var e=parseFloat(c);if(!isNaN(f)&&!isNaN(e)&&f!=e){return f<e?-1:1}if(typeof d=="string"&&typeof c=="string"){return d.localeCompare(c)}return d<c?-1:1};$WH.trim=function(a){return a.replace(/(^\s*|\s*$)/g,"")};$WH.rtrim=function(c,d){var b=c.length;while(--b>0&&c.charAt(b)==d){}c=c.substring(0,b+1);if(c==d){c=""}return c};$WH.sprintf=function(b){var a;for(a=1,len=arguments.length;a<len;++a){b=b.replace("$"+a,arguments[a])}return b};$WH.sprintfa=function(b){var a;for(a=1,len=arguments.length;a<len;++a){b=b.replace(new RegExp("\\$"+a,"g"),arguments[a])}return b};$WH.sprintfo=function(c){if(typeof c=="object"&&c.length){var a=c;c=a[0];var b;for(b=1;b<a.length;++b){c=c.replace("$"+b,a[b])}return c}};$WH.str_replace=function(e,d,c){while(e.indexOf(d)!=-1){e=e.replace(d,c)}return e};$WH.htmlentities=function(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(b){return"&#"+b.charCodeAt(0)+";"})};$WH.urlencode=function(a){a=encodeURIComponent(a);a=$WH.str_replace(a,"+","%2B");return a};$WH.urlencode2=function(a){a=encodeURIComponent(a);a=$WH.str_replace(a,"%20","+");a=$WH.str_replace(a,"%3D","=");return a};$WH.number_format=function(b){var a=(""+parseFloat(b)).split(".");b=a[0];a=a.length>1?"."+a[1]:"";if(b.length<=3){return b+a}return $WH.number_format(b.substr(0,b.length-3))+","+b.substr(b.length-3)+a};$WH.number_locale_format=function(f,c){var d="";var a=f;if(typeof c=="number"){d=Locale.locales[c].name}else{if(typeof c=="string"){d=c}else{d=Locale.getName()}}if(d.length==4){d=d.substr(0,2).toLowerCase()+"-"+d.substr(2).toUpperCase()}try{a=f.toLocaleString(d)}catch(b){a=f.toLocaleString()}return a};$WH.is_array=function(b){return !!(b&&b.constructor==Array)};$WH.in_array=function(c,g,h,e){if(c==null){return -1}if(h){return $WH.in_arrayf(c,g,h,e)}for(var d=e||0,b=c.length;d<b;++d){if(c[d]==g){return d}}return -1};$WH.in_arrayf=function(c,g,h,e){for(var d=e||0,b=c.length;d<b;++d){if(h(c[d])==g){return d}}return -1};$WH.rs=function(){var e=$WH.rs.random;var b="";for(var a=0;a<16;a++){var d=Math.floor(Math.random()*e.length);if(a==0&&d<11){d+=10}b+=e.substring(d,d+1)}return b};$WH.rs.random="0123456789abcdefghiklmnopqrstuvwxyz";$WH.isset=function(a){return typeof window[a]!="undefined"};if(!$WH.isset("console")){console={log:function(){}}}$WH.array_walk=function(d,h,c){var g;for(var e=0,b=d.length;e<b;++e){g=h(d[e],c,d,e);if(g!=null){d[e]=g}}};$WH.array_apply=function(d,h,c){var g;for(var e=0,b=d.length;e<b;++e){h(d[e],c,d,e)}};$WH.array_filter=function(c,g){var e=[];for(var d=0,b=c.length;d<b;++d){if(g(c[d])){e.push(c[d])}}return e};$WH.array_index=function(c,e,g,h){if(!$WH.is_array(c)){return false}if(!c.__R||h){c.__R={};if(!g){g=function(a){return a}}for(var d=0,b=c.length;d<b;++d){c.__R[g(c[d])]=d}}return(e==null?c.__R:!isNaN(c.__R[e]))};$WH.array_compare=function(d,c){if(d.length!=c.length){return false}var g={};for(var f=d.length;f>=0;--f){g[d[f]]=true}var e=true;for(var f=c.length;f>=0;--f){if(g[c[f]]===undefined){e=false}}return e};$WH.array_unique=function(b){var c=[];var e={};for(var d=b.length-1;d>=0;--d){e[b[d]]=1}for(var d in e){c.push(d)}return c};$WH.ge=function(a){if(typeof a!="string"){return a}return document.getElementById(a)};$WH.gE=function(a,b){return a.getElementsByTagName(b)};$WH.ce=(function(a){return function(b,d,e){var c=a(b);if(d){$WH.cOr(c,d)}if(e){$WH.ae(c,e)}return c}})(typeof document.createElementOriginal=="function"?document.createElementOriginal.bind(document):document.createElement.bind(document));$WH.de=function(a){if(!a||!a.parentNode){return}a.parentNode.removeChild(a)};$WH.ae=function(a,b){if($WH.is_array(b)){$WH.array_apply(b,a.appendChild.bind(a));return b}else{return a.appendChild(b)}};$WH.aef=function(a,b){return a.insertBefore(b,a.firstChild)};$WH.ee=function(a,b){if(!b){b=0}while(a.childNodes[b]){a.removeChild(a.childNodes[b])}};$WH.ct=function(a){return document.createTextNode(a)};$WH.st=function(a,b){if(a.firstChild&&a.firstChild.nodeType==3){a.firstChild.nodeValue=b}else{$WH.aef(a,$WH.ct(b))}};$WH.nw=function(a){a.style.whiteSpace="nowrap"};$WH.rf=function(){return false};$WH.rf2=function(a){a=$WH.$E(a);if(a.ctrlKey||a.shiftKey||a.altKey||a.metaKey){return}return false};$WH.tb=function(){this.blur()};$WH.aE=function(b,c,a){if(b.addEventListener){b.addEventListener(c,a,false)}else{if(b.attachEvent){b.attachEvent("on"+c,a)}}};$WH.dE=function(b,c,a){if(b.removeEventListener){b.removeEventListener(c,a,false)}else{if(b.detachEvent){b.detachEvent("on"+c,a)}}};$WH.sp=function(a){if(!a){a=event}if($WH.Browser.ie6789){a.cancelBubble=true}else{a.stopPropagation()}};$WH.sc=function(h,j,d,f,g){var e=new Date();var c=h+"="+escape(d)+"; ";e.setDate(e.getDate()+j);c+="expires="+e.toUTCString()+"; ";if(f){c+="path="+f+"; "}if(g){c+="domain="+g+"; "}document.cookie=c;$WH.gc(h);$WH.gc.C[h]=d};$WH.dc=function(a){$WH.sc(a,-1);$WH.gc.C[a]=null};$WH.gc=function(f){if($WH.gc.I==null){var e=unescape(document.cookie).split("; ");$WH.gc.C={};for(var c=0,a=e.length;c<a;++c){var g=e[c].indexOf("="),b,d;if(g!=-1){b=e[c].substr(0,g);d=e[c].substr(g+1)}else{b=e[c];d=""}$WH.gc.C[b]=d}$WH.gc.I=1}if(!f){return $WH.gc.C}else{return $WH.gc.C[f]}};$WH.ns=function(a){if($WH.Browser.ie6789){a.onfocus=$WH.tb;a.onmousedown=a.onselectstart=a.ondragstart=$WH.rf}};$WH.eO=function(b){for(var a in b){delete b[a]}};$WH.dO=function(a){function b(){}b.prototype=a;return new b};$WH.cO=function(c,a){for(var b in a){if(a[b]!==null&&typeof a[b]=="object"&&a[b].length){c[b]=a[b].slice(0)}else{c[b]=a[b]}}return c};$WH.cOr=function(e,b,a){for(var c in b){if(a&&(c.substr(0,a.length)==a)){continue}if(b[c]!==null&&typeof b[c]=="object"){if(b[c].length){e[c]=b[c].slice(0)}else{if(!e[c]){e[c]={}}$WH.cOr(e[c],b[c],a)}}else{e[c]=b[c]}}return e};$WH.fround=function(b){if(Math.fround){return Math.fround(b)}else{if(typeof Float32Array!="undefined"&&Float32Array){var a=new Float32Array(1);a[0]=+b;return a[0]}else{return b}}};$WH.Browser={ie:!!(window.attachEvent&&!window.opera),opera:!!window.opera,safari:navigator.userAgent.indexOf("Safari")!=-1,firefox:navigator.userAgent.indexOf("Firefox")!=-1,chrome:navigator.userAgent.indexOf("Chrome")!=-1};$WH.Browser.ie9=$WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 9.0")!=-1;$WH.Browser.ie8=$WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 8.0")!=-1&&!$WH.Browser.ie9;$WH.Browser.ie7=$WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 7.0")!=-1&&!$WH.Browser.ie8;$WH.Browser.ie6=$WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 6.0")!=-1&&!$WH.Browser.ie7;$WH.Browser.ie67=$WH.Browser.ie6||$WH.Browser.ie7;$WH.Browser.ie678=$WH.Browser.ie67||$WH.Browser.ie8;$WH.Browser.ie6789=$WH.Browser.ie678||$WH.Browser.ie9;$WH.OS={windows:navigator.appVersion.indexOf("Windows")!=-1,mac:navigator.appVersion.indexOf("Macintosh")!=-1,linux:navigator.appVersion.indexOf("Linux")!=-1};$WH.localStorage=new function(){this.isSupported=function(){var a;try{a="localStorage" in window&&window.localStorage!==null}catch(b){a=false}if(a){try{localStorage.setItem("test","123");a=localStorage.getItem("test")=="123";localStorage.removeItem("test")}catch(b){a=false}}$WH.localStorage.isSupported=(function(c){return c}).bind(null,a);return a};this.set=function(a,b){if(!$WH.localStorage.isSupported()){return}localStorage.setItem(a,b)};this.get=function(a){if(!$WH.localStorage.isSupported()){return}return localStorage.getItem(a)};this.remove=function(a){if(!$WH.localStorage.isSupported()){return}localStorage.removeItem(a)}};$WH.g_getWindowSize=function(){var a=0,b=0;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){a=document.documentElement.clientWidth;b=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){a=document.body.clientWidth;b=document.body.clientHeight}else{if(typeof window.innerWidth=="number"){a=window.innerWidth;b=window.innerHeight}}}return{w:a,h:b}};$WH.g_getScroll=function(){var a=0,b=0;if(typeof(window.pageYOffset)=="number"){a=window.pageXOffset;b=window.pageYOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollLeft;b=document.body.scrollTop}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollLeft;b=document.documentElement.scrollTop}}}return{x:a,y:b}};$WH.g_getCursorPos=function(c){var a,d;if(window.innerHeight){a=c.pageX;d=c.pageY}else{var b=$WH.g_getScroll();a=c.clientX+b.x;d=c.clientY+b.y}return{x:a,y:d}};$WH.ac=function(c,d){var a=0,g=0,b;while(c){a+=c.offsetLeft;g+=c.offsetTop;b=c.parentNode;while(b&&b!=c.offsetParent&&b.offsetParent){if(b.scrollLeft||b.scrollTop){a-=(b.scrollLeft|0);g-=(b.scrollTop|0);break}b=b.parentNode}c=c.offsetParent}if($WH.isset("Lightbox")&&Lightbox.isVisible()){d=true}if(d){var f=$WH.g_getScroll();a+=f.x;g+=f.y}var e=[a,g];e.x=a;e.y=g;return e};$WH.g_scrollTo=function(c,b){var m,l=$WH.g_getWindowSize(),o=$WH.g_getScroll(),j=l.w,e=l.h,g=o.x,d=o.y;c=$WH.ge(c);if(b==null){b=[]}else{if(typeof b=="number"){b=[b]}}m=b.length;if(m==0){b[0]=b[1]=b[2]=b[3]=0}else{if(m==1){b[1]=b[2]=b[3]=b[0]}else{if(m==2){b[2]=b[0];b[3]=b[1]}else{if(m==3){b[3]=b[1]}}}}m=$WH.ac(c);var a=m[0]-b[3],h=m[1]-b[0],k=m[0]+c.offsetWidth+b[1],f=m[1]+c.offsetHeight+b[2];if(k-a>j||a<g){g=a}else{if(k-j>g){g=k-j}}if(f-h>e||h<d){d=h}else{if(f-e>d){d=f-e}}scrollTo(g,d)};$WH.g_createReverseLookupJson=function(b){var c={};for(var a in b){c[b[a]]=a}return c};$WH.g_getLocaleFromDomain=function(b){var d=$WH.g_getLocaleFromDomain.L;if(b&&(typeof b=="string")){var c=b.split(".");for(var a=0;a<c.length;a++){if(c[a] in d){return d[c[a]]}}}return 0};$WH.g_getLocaleFromDomain.L={ko:1,fr:2,de:3,cn:4,es:6,ru:7,pt:8,it:9,legion:"beta",www:0};$WH.g_getDomainFromLocale=function(d){var g;if($WH.g_getDomainFromLocale.L){g=$WH.g_getDomainFromLocale.L}else{g=$WH.g_getDomainFromLocale.L=$WH.g_createReverseLookupJson($WH.g_getLocaleFromDomain.L);if((typeof g_dev!="undefined")&&g_dev){var f="",b="",e;e=document.location.hostname.split(".");e.splice(-2,2);for(var a=0;a<e.length;a++){if(e[a] in $WH.g_getLocaleFromDomain.L){continue}if(/staging\d*/.test(e[a])){f=f+"."+e[a]}else{b=b+e[a]+"."}}for(var c in $WH.g_getDomainFromLocale.L){if(c==0){$WH.g_getDomainFromLocale.L[c]=(b+f).replace(/\.+/g,".").replace(/^\./,"").replace(/\.$/,"")}else{$WH.g_getDomainFromLocale.L[c]=b+$WH.g_getDomainFromLocale.L[c]+f}}}}return(g[d]?g[d]:"www")};$WH.g_getIdFromTypeName=function(a){var b=$WH.g_getIdFromTypeName.L;return(b[a]?b[a]:-1)};$WH.g_getIdFromTypeName.L={npc:1,object:2,item:3,itemset:4,"item-set":4,quest:5,spell:6,zone:7,faction:8,pet:9,achievement:10,title:11,event:12,statistic:16,currency:17,building:20,follower:21,garrisonability:22,missionability:22,"mission-ability":22,mission:23,ship:25,threat:26,resource:27,champion:28,icon:29,"order-advancement":30,affix:40,guide:100,"transmog-set":101,outfit:110,petability:200,"pet-ability":200};$WH.g_ajaxIshRequest=function(b,e){var c=document.getElementsByTagName("head")[0];if(b.substr(0,5)=="http:"&&location.protocol=="https:"){if(typeof console!="undefined"&&console){var d="Refused to ajaxish load "+b+" from "+location.href;if(typeof console.log=="function"){console.log(d)}else{if(typeof console.error=="function"){console.error(d)}}}return false}if(e){$WH.ae(c,$WH.ce("script",{type:"text/javascript",src:b}));return}var a=$WH.g_getGets();if(a.refresh!=null){if(a.refresh.length){b+=("&refresh="+a.refresh)}else{b+="&refresh"}}if(a.locale!=null){b+="&locale="+a.locale}if(a.ptr!=null){b+="&ptr"}$WH.ae(c,$WH.ce("script",{type:"text/javascript",src:b,charset:"utf8"}))};$WH.g_getGets=function(){if($WH.g_getGets.C!=null){return $WH.g_getGets.C}var b=$WH.g_getQueryString();var a=$WH.g_parseQueryString(b);$WH.g_getGets.C=a;return a};$WH.g_convertNodesToHtml=function(a){var b=$WH.ce("div");$WH.ae(b,a);return b.innerHTML};$WH.g_escapeHtml=function(a){var b=$WH.ce("div");$WH.ae(b,$WH.ct(a));return b.innerHTML};$WH.g_visitUrlWithPostData=function(b,d){var c=$WH.ce("form");c.action=b;c.method="post";for(var a in d){if(d.hasOwnProperty(a)){var e=$WH.ce("input");e.type="hidden";e.name=a;e.value=d[a];$WH.ae(c,e)}}$WH.ae(document.body,c);c.submit()};$WH.g_getQueryString=function(){var a="";if(location.pathname){a+=location.pathname.substr(1)}if(location.search){if(location.pathname){a+="&"}a+=location.search.substr(1)}return a};$WH.g_parseQueryString=function(e){e=decodeURIComponent(e);var d=e.split("&");var c={};for(var b=0,a=d.length;b<a;++b){$WH.g_splitQueryParam(d[b],c)}return c};$WH.g_splitQueryParam=function(c,d){var e=c.indexOf("=");var a;var b;if(e!=-1){a=c.substr(0,e);b=c.substr(e+1)}else{a=c;b=""}d[a]=b};$WH.g_createRect=function(d,c,a,b){return{l:d,t:c,r:d+a,b:c+b}};$WH.g_intersectRect=function(d,c){return !(d.l>=c.r||c.l>=d.r||d.t>=c.b||c.t>=d.b)};$WH.g_keyPressIsAlphaNumeric=function(b){var a=document.all?b.keycode:b.which;return((a>47&&a<58)||(a>64&&a<91)||(a>95&&a<112)||a==222||a==0)};$WH.g_isRemote=function(){return typeof g_wowhead=="undefined"||!g_wowhead};$WH.g_isDev=function(){return typeof g_dev!="undefined"&&g_dev};$WH.g_isBeta=function(){return typeof g_beta!="undefined"&&g_beta};$WH.g_betaIsActive=function(){return typeof g_betaactive!="undefined"&&g_betaactive};$WH.g_isPtr=function(){return typeof g_ptr!="undefined"&&g_ptr};$WH.g_ptrIsActive=function(){return typeof g_ptractive!="undefined"&&g_ptractive};$WH.g_setupFooterMenus=function(){var b={"footer-help-menu":mn_footer_help,"footer-tools-menu":mn_footer_tools,"footer-about-menu":mn_footer_about};b["footer-change-view"]=mn_footer_platform;for(var c in b){if(!b.hasOwnProperty(c)){continue}var a=$("#"+c);if(a.length){a.addClass("hassubmenu");Menu.add(a.get(0),b[c])}}};$WH.g_getConfidenceInterval=function(b,a){if(b==0&&a==0){return 0}var e=1.96,d=1*b/a;var c=(d+e*e/(2*a)-e*Math.sqrt((d*(1-d)+e*e/(4*a))/a))/(1+e*e/a);if(isNaN(c)||c==0){return(a*-1+b)/10000}return c};$WH.getScreenshotUrl=function(d,c,a){if(!c){c="normal"}var b=c=="normal"&&typeof a=="string"&&a?"-"+g_urlize(a,true):"";return $WH.staticUrl+"/uploads/screenshots/"+c+"/"+d+b+".jpg"};$WH.g_max_level=110;$WH.g_max_skill=800;$WH.g_convertRatingToPercent=function(b,d,h,a){var f=$WH.g_convertRatingToPercent.RB,e=$WH.g_convertRatingToPercent.LH,g=$WH.g_convertRatingToPercent.LT;if(b<0){b=1}else{if(b>$WH.g_max_level){b=$WH.g_max_level}}if((d==12||d==13||d==14||d==15)&&b<34){b=34}if((d==28||d==36)&&(a==2||a==6||a==7||a==11)){f[d]/=1.3}if(h<0){h=0}if(g&&g[d]&&(b>=80)&&(b-80<g[d].length)){return h/g[d][b-80]}var c;if(!f||f[d]==null){c=0}else{var j;if(b>80){j=e[b]}else{if(b>70){j=(82/52)*Math.pow((131/63),((b-70)/10))}else{if(b>60){j=(82/(262-3*b))}else{if(b>10){j=((b-8)/52)}else{j=2/52}}}}c=h/f[d]/j}return c};$WH.g_statToRating={11:0,12:1,13:2,14:3,15:4,16:5,17:6,18:7,19:8,20:9,21:10,25:15,26:15,27:15,28:17,29:18,30:19,31:5,32:8,34:15,35:15,36:17,37:23,44:24,49:25,57:26,59:11,60:12,61:13,62:16,63:20,64:21,40:29};$WH.g_statToJson={0:"mana",1:"health",3:"agi",4:"str",5:"int",6:"spi",7:"sta",8:"energy",9:"rage",10:"focus",13:"dodgertng",14:"parryrtng",16:"mlehitrtng",17:"rgdhitrtng",18:"splhitrtng",19:"mlecritstrkrtng",20:"rgdcritstrkrtng",21:"splcritstrkrtng",22:"_mlehitrtng",23:"_rgdhitrtng",24:"_splhitrtng",25:"_mlecritstrkrtng",26:"_rgdcritstrkrtng",27:"_splcritstrkrtng",28:"mlehastertng",29:"rgdhastertng",30:"splhastertng",31:"hitrtng",32:"critstrkrtng",33:"_hitrtng",34:"_critstrkrtng",35:"resirtng",36:"hastertng",37:"exprtng",38:"atkpwr",39:"rgdatkpwr",40:"versatility",41:"splheal",42:"spldmg",43:"manargn",44:"armorpenrtng",45:"splpwr",46:"healthrgn",47:"splpen",49:"mastrtng",50:"armorbonus",51:"firres",52:"frores",53:"holres",54:"shares",55:"natres",56:"arcres",57:"pvppower",58:"amplify",59:"multistrike",60:"readiness",61:"speedbonus",62:"lifesteal",63:"avoidance",64:"sturdiness",66:"cleave",71:"agistrint",72:"agistr",73:"agiint",74:"strint"};$WH.g_jsonToStat={};for(var i in $WH.g_statToJson){$WH.g_jsonToStat[$WH.g_statToJson[i]]=i}$WH.g_individualToGlobalStat={16:31,17:31,18:31,19:32,20:32,21:32,22:33,23:33,24:33,25:34,26:34,27:34,28:36,29:36,30:36};$WH.g_convertScalingFactor=function(c,b,g,d,k){var f=$WH.g_convertScalingFactor.SV;var e=$WH.g_convertScalingFactor.SD;if(!f||!f[c]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no item scaling values for level "+c)}return(k?{}:0)}var j={},h=f[c],a=e[g];if(!a||!(d>=0&&d<=9)){j.v=h[b]}else{j.n=$WH.g_statToJson[a[d]];j.s=a[d];j.v=Math.floor(h[b]*a[d+10]/10000)}return(k?j:j.v)};g_itemScalingCallbacks=[];if(!$WH.wowheadRemote){$WH.g_ajaxIshRequest("/data=item-scaling")}$WH.g_convertScalingSpell=function(b,g,j){var k={},f=$WH.g_convertScalingSpell.SV,d=$WH.g_convertScalingSpell.SD,a,l;if(!d||!d[g]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no spell scaling distributions for dist "+g)}return k}if(!f[b]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no spell scaling values for level "+b)}return k}a=d[g];if(!a[3]){if(g_user.roles&U_GROUP_ADMIN){alert("This spell should not scale at all")}return k}else{if(a[3]==-1){if(g_user.roles&U_GROUP_ADMIN){alert("This spell should use the generic scaling distribution 12")}a[3]=12}}if(!f[b][a[3]-1]){if(g_user.roles&U_GROUP_ADMIN){alert("Unknown category for spell scaling "+a[3])}return k}if(a[15]>0&&a[15]<b){b=a[15]}l=f[b][a[3]-1];if(a[13]){l*=(Math.min(b,a[14])+(a[13]*Math.max(0,b-a[14])))/b}k.cast=Math.min(a[1],a[1]>0&&b>1?a[0]+(((b-1)*(a[1]-a[0]))/(a[2]-1)):a[0]);k.effects={};for(var c=0;c<3;++c){var m=a[4+c],h=a[7+c],e=a[10+c],n=k.effects[c+1]={};if(j&&j.hasOwnProperty(c)){m=j[c].damage||m;h=j[c].range||h;e=j[c].combo||e}n.avg=m*l*(a[1]>0?k.cast/a[1]:1);n.min=Math.round(n.avg)-Math.floor(n.avg*h/2);n.max=Math.round(n.avg)+Math.floor(n.avg*h/2);n.pts=Math.round(e*l);n.avg=Math.max(Math.ceil(m),Math.round(n.avg))}k.cast=Math.round(k.cast/10)/100;return k};if(!$WH.wowheadRemote){$WH.g_ajaxIshRequest("/data=spell-scaling")}$WH.g_getDataSource=function(){if($WH.isset("g_pageInfo")){switch(g_pageInfo.type){case 3:if($WH.isset("g_items")){return g_items}break;case 6:if($WH.isset("g_spells")){return g_spells}break;case 200:if($WH.isset("g_petabilities")){return g_petabilities}break}}return[]};$WH.g_setJsonItemLevel=function(s,a,g){if(g&&((g.scalingcategory-11)>0)){var m=g.maxlvlscaling?Math.min(a,g.maxlvlscaling):a;var e=$WH.g_getSpellScalingValue(g.scalingcategory,m);for(var p=1;p<3;++p){var l=g["itemenchspell"+p];var b=g["itemenchtype"+p];var n=$WH.g_statToJson[l];if((b==5)&&s[n]){var c=g["damage"+p];if(c){s[n]=Math.round(e*c)}}}if(g.allstats){for(var r in s){s[r]=Math.round(e*g.damage1)}}}if(!s.scadist||!s.scaflags){return}s.bonuses=s.bonuses||{};var j=s.scaflags&255,h=(s.scaflags>>8)&255,o=(s.scaflags&(1<<16))!=0,d=(s.scaflags&(1<<17))!=0,u=(s.scaflags&(1<<18))!=0,t;switch(j){case 5:case 1:case 7:case 17:t=7;break;case 3:case 12:t=8;break;case 16:case 11:case 14:t=9;break;case 15:t=10;break;case 23:case 21:case 22:case 13:t=11;break;default:t=-1}if(t>=0){for(var p=0;p<10;++p){var f=$WH.g_convertScalingFactor(a,t,s.scadist,p,1);if(f.n){s[f.n]=f.v}s.bonuses[f.s]=f.v}}if(u){s.splpwr=s.bonuses[45]=$WH.g_convertScalingFactor(a,6)}if(o){switch(j){case 3:s.armor=$WH.g_convertScalingFactor(a,11+h);break;case 5:s.armor=$WH.g_convertScalingFactor(a,15+h);break;case 1:s.armor=$WH.g_convertScalingFactor(a,19+h);break;case 7:s.armor=$WH.g_convertScalingFactor(a,23+h);break;case 16:s.armor=$WH.g_convertScalingFactor(a,28);break;case 14:s.armor=$WH.g_convertScalingFactor(a,29);break;default:s.armor=0}}if(d){var k=(s.mledps?"mle":"rgd"),q;switch(j){case 23:case 21:case 22:case 13:s.dps=s[k+"dps"]=$WH.g_convertScalingFactor(a,u?2:0);q=0.3;break;case 17:s.dps=s[k+"dps"]=$WH.g_convertScalingFactor(a,u?3:1);q=0.2;break;case 15:s.dps=s[k+"dps"]=$WH.g_convertScalingFactor(a,h==19?5:4);q=0.3;break;default:s.dps=s[k+"dps"]=0;q=0}s.dmgmin=s[k+"dmgmin"]=Math.floor(s.dps*s.speed*(1-q));s.dmgmax=s[k+"dmgmax"]=Math.floor(s.dps*s.speed*(1+q))}};$WH.g_setJsonSpellLevel=function(a,c,b){if(!a.scadist){return}$WH.cO(a,$WH.g_convertScalingSpell(c,a.scadist,b))};$WH.g_scaleItemEnchantment=function(f,c){var h=f.enchantment;if(f.scalinginfo&&(f.scalinginfo.scalingcategory-11)>0){var e=h.match(/\d+/g);if(e){var g=parseInt(f.scalinginfo.maxlvlscaling)?Math.min(c,parseInt(f.scalinginfo.maxlvlscaling)):c;var b=$WH.g_getSpellScalingValue(f.scalinginfo.scalingcategory,g);for(var d=0;d<e.length;++d){var a=f.scalinginfo["damage"+(d+1)];if(a){h=h.replace(e[d],Math.round(b*a))}}}}return h};$WH.g_getItemRandPropPointsType=function(a){var b=a.slotbak?a.slotbak:a.slot;switch(b){case 1:case 4:case 5:case 7:case 15:case 17:case 20:case 25:return 0;case 26:if(a.subclass==19){return 3}return 0;case 13:case 21:case 22:return 3;case 3:case 6:case 8:case 10:case 12:return 1;case 2:case 9:case 11:case 14:case 16:case 23:return 2;case 28:return 4;default:return -1}};$WH.scaleItemLevel=function(a,o){var g=a.level;if(a.scadist){var d=$WH.g_convertScalingFactor.SD;var s=$WH.g_curvePoints;var l=d?d[a.scadist]:null;if(s&&l&&l[22]&&l[22]>0){var t=l[22];var u=o?o:$WH.g_max_level;if(l[20]&&u<l[20]){u=l[20]}if(l[21]&&u>l[21]){u=l[21]}var c=s[t];if(c&&c.length>0){var p=-1;for(var f in c){var q=c[f];if(q[1]>=u){p=f;break}}var m=c[p!=-1?p:(c.length-1)];var e=null;var k=0;if(p>0){e=c[p-1];var r=m[1]-e[1];if(r>0){var j=u-e[1];var n=j/r;var h=m[2]-e[2];var b=n*h;k=e[2]+b}}else{k=m[2]}if(k>0){g=Math.round(k)}}}}return g};$WH.g_applyStatModifications=function(Z,D,g,A,Y,e){if(!Z.quality&&Z.name&&Z.name.length&&parseInt(Z.name[0])){Z.quality=8-parseInt(Z.name[0])}var a={};if(Z.hasOwnProperty("level")){a=$WH.dO(Z)}else{$WH.cOr(a,Z,"__")}if(Y&&Y.length){var v=false;for(var T=0;T<Y.length;++T){var m=Y[T];if(m>0&&$WH.isset("g_itembonuses")&&g_itembonuses[m]){var p=g_itembonuses[m];for(var R=0;R<p.length;++R){var t=p[R];switch(t[0]){case 11:case 13:if(v===false||t[2]<v){a.scadist=t[1];a.scadistbonus=m;v=t[2]}break;default:break}}}}}a.level=$WH.scaleItemLevel(a,e);if(g=="pvp"&&Z.pvpUpgrade){a.level+=Z.pvpUpgrade}if(a.subitems&&a.subitems[D]){for(var aa in a.subitems[D].jsonequip){if(!a.hasOwnProperty(aa)){a[aa]=0}a[aa]+=a.subitems[D].jsonequip[aa]}}if(Y&&Y.length){if(Z.statsInfo){a.statsInfo={};for(var T in Z.statsInfo){a.statsInfo[T]={alloc:parseInt(Z.statsInfo[T].alloc),qty:Z.statsInfo[T].qty,socketMult:Z.statsInfo[T].socketMult}}}var w=[0,0,0,0,2147483647,2147483647,2147483647,2147483647];a.extraStats=[];var J=a.scadistbonus?false:0;for(var T=0;T<Y.length;++T){var m=Y[T];if(m>0&&$WH.isset("g_itembonuses")&&g_itembonuses[m]){var p=g_itembonuses[m];for(var R=0;R<p.length;++R){var t=p[R];switch(t[0]){case 1:if(!a.scadistbonus){a.level+=t[1];J=false}break;case 2:if(a.statsInfo){if(a.statsInfo.hasOwnProperty(t[1])){a.statsInfo[t[1]].alloc+=t[2]}else{a.extraStats.push(t[1]);a.statsInfo[t[1]]={alloc:parseInt(t[2]),qty:0,socketMult:0}}}break;case 3:a.name=(8-parseInt(t[1]))+(a.name?a.name.substr(1):"");a.quality=parseInt(t[1]);break;case 4:var S=t[1];var b=t[2];var N=4;var L=4;do{if(b<=w[N]){var B=S;S=w[N-4];w[N-4]=B;var H=b;b=w[N];w[N]=H}++N;--L}while(L);break;case 5:if($WH.isset("g_item_namedescriptions")&&g_item_namedescriptions[t[1]]){a.nameSuffix=g_item_namedescriptions[t[1]][0]}break;case 6:var E=a.nsockets?a.nsockets:0;a.nsockets=E+t[1];for(var M=E;M<(E+t[1]);++M){a["socket"+(M+1)]=t[2]}break;case 7:break;case 8:a.reqlevel+=t[1];break;case 14:if(J!==false){J=Math.max(J,t[1])}break;default:break}}}}if(J){a.level=J;a.previewLevel=J}if($WH.isset("g_item_namedescriptions")){a.namedesc=a.namedesc?a.namedesc:"";for(var R=0;R<4;++R){if(w[R]&&g_item_namedescriptions[w[R]]){a.namedesc+=(!a.namedesc?"":" ")+g_item_namedescriptions[w[R]][0];if(!R){a.namedesccolor=g_item_namedescriptions[w[R]][1]}}}}}if(Z.statsInfo&&Z.level&&$WH.g_applyStatModifications.ScalingData){var c=$WH.g_applyStatModifications.ScalingData.AV,G=$WH.g_applyStatModifications.ScalingData.SV,x=$WH.g_applyStatModifications.ScalingData.AL;a.level=A?A:(g&&Z.upgrades&&Z.upgrades[g-1]?(a.level+Z.upgrades[g-1]):a.level);var s=a.level-Z.level;var F=Math.pow(1.15,s/15);var o=$WH.g_getItemRandPropPointsType(a);var I=G[a.level];var q=0;if(o!=-1){var k=0;switch(a.quality){case 5:case 4:k=0;break;case 7:case 3:k=1;break;case 2:k=2;break;default:break}var r=k*5+o;q=I[r]?I[r]:0}var h=G[a.level][15];for(var T in $WH.g_statToJson){var O=$WH.g_statToJson[T];if(a[O]||(a.statsInfo&&a.statsInfo[T])){var f=0;var X=0;if(a.statsInfo.hasOwnProperty(T)){f=parseFloat(a.statsInfo[T].socketMult);X=parseInt(a.statsInfo[T].alloc)}var y=Math.round(f*h);if(X&&q>0){a[O]=Math.round((X/10000)*q)-y}else{a[O]=Math.floor(((a[O]+y)*F)-y)}switch(O){case"agistrint":a.agi=a.str=a["int"]=a[O];break;case"agistr":a.agi=a.str=a[O];break;case"agiint":a.agi=a["int"]=a[O];break;case"strint":a.str=a["int"]=a[O];break;default:break}}}if(a.armor&&c[a.level]){var u=(a.quality==7)?3:a.quality;var V=(a.subclass==-6)?1:a.subclass;if($WH.in_array([1,2,3,4],V)!=-1){var W=c[a.level][11+u];var l=c[a.level][V-1];var P=x[a.slot][V-1];a.armor=Math.floor(l*W*P+0.5)}if(a.subclass==6){a.armor=c[a.level][4+u]}}if(a.dps){var Q=["dps","mledps","rgddps"];var d=["dmgmin1","mledmgmin","rgddmgmin","dmgmax1","mledmgmax","rgddmgmax"];var C=0,K=0,z=0;var U=$WH.g_getEffectiveWeaponDamage(a.level,a.classs,a.subclass,a.quality,a.speed*1000,a.dmgrange,a.slotbak?a.slotbak:a.slot,a.flags2,false);K=Math.floor(U);z=$WH.g_getEffectiveWeaponDamage(a.level,a.classs,a.subclass,a.quality,a.speed*1000,a.dmgrange,a.slotbak?a.slotbak:a.slot,a.flags2,true);C=((U+z)/2)/a.speed;for(var T in Q){if(a[Q[T]]){a[Q[T]]=parseFloat(C.toFixed(2))}}for(var T in d){if(a[d[T]]){if(d[T].indexOf("max")!=-1){a[d[T]]=z}else{a[d[T]]=K}}}}}return a};$WH.g_applyStatModifications.ITEM_CHALLENGEMODE_LEVEL=630;$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL=95;$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL=160;$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL=300;$WH.g_getItemDamageValue=function(c,e,b){var a=$WH.g_applyStatModifications.ScalingData.DV;var d=7*b+e;if(a&&a[c]&&a[c][d]){return a[c][d]}return 0};$WH.g_getEffectiveWeaponDamage=function(e,a,f,l,d,g,b,m,j){g=g?g:0;var h=0;var k=0;var n=false;var c=(m&512);if(a!=2){return 0}if(l>7){return 0}if(l==7){l=3}if(b>22){if(b==24){k=0;n=true}if(!n&&(b<=24||b>26)){n=true}}else{if(b==21||b==22||b==13){if(!c){k=$WH.g_getItemDamageValue(e,l,0)}else{k=$WH.g_getItemDamageValue(e,l,1)}n=true}if(!n&&b!=15){if(b!=17){n=true}else{if(!c){k=$WH.g_getItemDamageValue(e,l,2)}else{k=$WH.g_getItemDamageValue(e,l,3)}n=true}}}if(!n&&f>=2){if(f==2||f==3||f==18){if(!c){k=$WH.g_getItemDamageValue(e,l,2)}else{k=$WH.g_getItemDamageValue(e,l,3)}n=true}if(!n&&f==19){k=$WH.g_getItemDamageValue(e,l,1)}}if(k>0){if(!j){h=k*(d/1000)*(1-g/2)}else{h=Math.floor((k*(d/1000)*(1+g/2))+0.5)}}return h};$WH.g_getJsonReforge=function(b,c){if(!c){if(!$WH.g_reforgeStats){return[]}b.__reforge={};b.__reforge.all=[];for(var c in $WH.g_reforgeStats){var d=$WH.g_getJsonReforge(b,c);if(d.amount){b.__reforge.all.push(d)}}return b.__reforge.all}if(!$WH.g_reforgeStats||!$WH.g_reforgeStats[c]){return{}}b.__statidx={};for(var a in b){if($WH.g_individualToGlobalStat[$WH.g_jsonToStat[a]]){b.__statidx[$WH.g_individualToGlobalStat[$WH.g_jsonToStat[a]]]=b[a]}else{b.__statidx[$WH.g_jsonToStat[a]]=b[a]}}if(!b.__reforge){b.__reforge={}}var d=b.__reforge[c]=$WH.dO($WH.g_reforgeStats[c]);b.__reforge[c].amount=Math.floor(d.v*(b.__statidx[d.i1]&&!b.__statidx[d.i2]?b.__statidx[d.i1]:0));return b.__reforge[c]};$WH.g_getJsonItemEnchantMask=function(a){if(a.classs==2&&a.subclass==19){return 1<<(21-1)}return 1<<(a.slot-1)};$WH.g_getCurveValue=function(d,b){var c;if(!$WH.g_curvePoints||!(c=$WH.g_curvePoints[d])){return undefined}var f=c[0][1];var e=c[0][2];if(f>b){return e}for(var g=0,a;a=c[g];g++){if(b==a[1]){return a[2]}if(b<a[1]){return(a[2]-e)/(a[1]-f)*(b-f)+e}f=a[1];e=a[2]}return e};$WH.g_setItemModifications=function(l,x,U,h,d){if(!$WH.isset("g_items")||!g_items[x]||!g_items[x].jsonequip){return l}U=U?U.split(":"):null;var o=g_items[x].bonusesData;var s=0;var n=U?U.indexOf("u"):-1;if(o&&n!=-1){s=U[n+1];U.splice(n,1)}var w=0;switch(h){case"chal":w=$WH.g_applyStatModifications.ITEM_CHALLENGEMODE_LEVEL;break;case"twtbc":w=$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL;break;case"twwotlk":w=$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL;break;case"twcata":w=$WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL;break}h=!w?h:null;var N=$WH.g_applyStatModifications(g_items[x].jsonequip,0,h,w,U,d);if(!N.name&&g_items[x].hasOwnProperty("name_"+Locale.getName())){N.name=""+(8-g_items[x].quality)+g_items[x]["name_"+Locale.getName()]}if(s){var C=$WH.g_bonusesBtnGetContextBonusId(U);var t=o[C].sub[s].sub;for(var E in t){var g=$WH.g_applyStatModifications(g_items[x].jsonequip,0,h,w,[C,E]);for(var Q in g.statsInfo){var e=g[$WH.g_statToJson[Q]];if(N.statsInfo[Q]){if(typeof N[$WH.g_statToJson[Q]]=="number"||!N[$WH.g_statToJson[Q]]){var I=N[$WH.g_statToJson[Q]]?N[$WH.g_statToJson[Q]]:e;N[$WH.g_statToJson[Q]]={};N[$WH.g_statToJson[Q]]["min"]=I;N[$WH.g_statToJson[Q]]["max"]=I}var R=N[$WH.g_statToJson[Q]]["min"];var B=N[$WH.g_statToJson[Q]]["max"];if(e<R){N[$WH.g_statToJson[Q]]["min"]=e}else{if(e>B){N[$WH.g_statToJson[Q]]["max"]=e}}}}}}l=l.replace(/(<!--ilvl-->)\d+\+?/,function(X,W){return W+N.level+(N.previewLevel?"+":"")});var k=false;if(N.scadist){var p=$WH.g_convertScalingFactor.SD;var F=p?p[N.scadist]:null;if(F&&F[21]){k=true;var u=(F[20]?F[20]:1);var A=F[21];d=((d&&d<=A)?d:A);l=l.replace(/(<!--lvl-->)\d+/g,function(X,W){return W+((d&&d<=A)?d:A)});l=l.replace(/(<!--minlvl-->)\d+/,function(X,W){return W+u});l=l.replace(/(<!--maxlvl-->)\d+/,function(X,W){return W+A});var G=false;l=l.replace(/<!--i\?(\d+):(\d+):(\d+):(\d+)(?::(\d+):(\d+))?/,function(aa,ac,Y,W,Z,X,ab){G=true;return"<!--i?"+ac+":"+u+":"+A+":"+d+":"+N.scadist+":"+(ab||0)});if(!G){l+="<!--i?"+x+":"+u+":"+A+":"+d+":"+N.scadist+":0-->"}l=l.replace(/(<!--huindex-->)\d+/,function(X,W){var Y=0;if(N.scadistbonus&&N.heirloombonuses){if(parseInt(N.scadistbonus)==N.heirloombonuses[0]){Y=1}else{if(parseInt(N.scadistbonus)==N.heirloombonuses[1]){Y=2}}}return W+Y});var V=l.match(/<!--\?([0-9-:]*)-->/);if(V){V=V[1].split(":");var O=parseInt(V[4])||0;if(O>0){var S={scadist:O};$WH.g_setJsonSpellLevel(S,d);if(S.effects){l=$WH.g_adjustSpellPoints(l,S)}}}}}else{l=l.replace(/<!--i\?(\d+):(\d+):(\d+):(\d+)(?::(\d+):(\d+))?/,function(aa,ac,Y,W,Z,X,ab){return"<!--i?"+ac+":"+Y+":"+W+":"+(d?d:W)})}var K;if(K=$WH.ge("sl"+x)){K.style.display=k?"":"none"}l=l.replace(/(<!--pvpilvl-->)\d+/,function(X,W){return W+(N.level+((h!="pvp")?N.pvpUpgrade:0))});l=l.replace(/(<!--ilvldelta-->)\d+/,function(Y,W){var X=1718;var Z=Math.floor($WH.g_getCurveValue(X,N.level)||2);return W+Z});l=l.replace(/(<!--rlvl-->)\d+/,function(X,W){return W+N.reqlevel});l=l.replace(/(<!--uindex-->)\d+/,function(X,W){return(h&&h!="pvp")?(W+h):X});var a=(typeof N.dmgrange!="undefined")&&N.dmgrange;var P=new RegExp("(<!--dmg-->)\\d+"+(a?"(\\D*?)\\d+":"")+"");l=l.replace(P,function(Y,W,X){return W+N.dmgmin1+(a?(X+N.dmgmax1):"")});l=l.replace(/(<!--dps-->\D*?)(\d+\.\d+)/,function(X,W){return W+(N.dps?N.dps.toFixed(2):"0")});l=l.replace(/(<!--amr-->)\d+/,function(X,W){return W+N.armor});l=l.replace(/<span><!--stat(\d+)-->[-+][\d\.,]+(\D*?)<\/span>(<!--e-->)?(<!--ps-->)?(<br ?\/?>)?/gi,function(W,ab,Z,ac,X,af){var Y,ae=(N[$WH.g_statToJson[ab]]?N[$WH.g_statToJson[ab]]:0);if(ae){var aa=s&&ae.min?ae.min:ae;var ad=s&&ae.max?ae.max:ae;ae=(aa>0?"+":"-")+$WH.number_locale_format(aa!=ad?(aa+"-"+ad):aa);Y="";af=(af?"<br />":"")}else{ae="+0";Y=' style="display: none"';af=(af?"<!--br-->":"")}return"<span"+Y+"><!--stat"+ab+"-->"+ae+Z+"</span>"+(ac||"")+(X||"")+af});var m=0;switch(g_items[x].slot){case 2:case 11:m=3;break;case 12:m=2;break;case 13:case 14:case 15:case 17:case 21:case 22:case 23:case 25:case 26:m=1;break}var v=($WH.g_convertRatingToPercent.hasOwnProperty("RM")&&$WH.g_convertRatingToPercent.RM.hasOwnProperty(N.level))?$WH.g_convertRatingToPercent.RM[N.level][m]:1;if(typeof v=="undefined"){v=1}l=l.replace(/<span class="q2">((?:<!--stat\d+-->)?.*?[-+])<!--rtg(\d+)-->[\d\.,]+(.*?)<\/span>(<br \/>)?/gi,function(W,Y,Z,ad,ae){var X,ac=(N[$WH.g_statToJson[Z]]?N[$WH.g_statToJson[Z]]:0);if(ac){var aa=Math.floor((s&&ac.min?ac.min:ac)*v);var ab=Math.floor((s&&ac.max?ac.max:ac)*v);ac=$WH.number_locale_format(aa!=ab?(aa+"-"+ab):aa);X="";ae=(ae?"<br />":"")}else{X=' style="display: none"';ae=(ae?"<!--br-->":"")}return'<span class="q2"'+X+">"+Y+"<!--rtg"+Z+"-->"+ac+ad+"</span>"+ae});if(N.extraStats&&N.extraStats.length){l=l.replace(/<!--re--><span[^<]*?<\/span>(<br \/>)?/,"");var y=[4,3,5,71,72,73,74,7,1,0,8,9,2,10];l=l.replace(/<!--ebstats-->/,function(ae){var Z="";for(var Y=0;Y<N.extraStats.length;++Y){var W=N.extraStats[Y];if(y.indexOf(W)==-1){continue}var aa="$1$2 "+($WH.g_statToJson&&$WH.g_statToJson[W]&&LANG.traits[$WH.g_statToJson[W]]?LANG.traits[$WH.g_statToJson[W]][1]:"Unknown");var ab=$WH.g_statToJson&&$WH.g_statToJson[W]?N[$WH.g_statToJson[W]]:0;var X=Math.floor((s&&ab.min?ab.min:ab)*v);var ac=Math.floor((s&&ab.max?ab.max:ab)*v);var ad=$WH.number_locale_format(X!=ac?(X+"-"+ac):X);Z+="<br /><span><!--stat"+W+"-->"+$WH.sprintf(aa,(X<0)?"-":"+",ad)+"</span>"}return Z+ae});l=l.replace(/<!--egstats-->/,function(ag){var Z="";for(var Y=0;Y<N.extraStats.length;++Y){var W=N.extraStats[Y];if(y.indexOf(W)!=-1){continue}var ab="$1$2 "+($WH.g_statToJson&&$WH.g_statToJson[W]&&LANG.traits[$WH.g_statToJson[W]]?LANG.traits[$WH.g_statToJson[W]][1]:"Unknown");var ac=$WH.g_statToJson&&$WH.g_statToJson[W]?N[$WH.g_statToJson[W]]:0;var X=Math.floor((s&&ac.min?ac.min:ac)*v);var ad=Math.floor((s&&ac.max?ac.max:ac)*v);var af=$WH.number_locale_format(X!=ad?(X+"-"+ad):X);var aa=$WH.sprintf("<!--rtg$1-->$2",W,af);var ah="";if($WH.g_statToRating&&$WH.g_statToRating[W]){ah=$WH.sprintf("&nbsp;<small>(<!--rtg%$1-->0&nbsp;@&nbsp;L$2"+$WH.g_max_level+")</small>",W,s?"":"<!--lvl-->")}var ae="";if(W==50){ae="<!--stat%d-->"}if(W==64){ab=ab.substr(5);ah=""}Z+='<br /><span class="q2">'+ae+$WH.sprintf(ab,(X>=0)?"+":"-",aa)+ah+"</span>"}return Z+ag})}l=l.replace(/(<!--nstart-->)(.*)(<!--nend-->)/,function(Z,aa,Y,W){var ac=8-parseInt(N.name.substr(0,1));var X=N.name.substr(1);var ab=N.nameSuffix?(" "+N.nameSuffix):"";return aa+$WH.sprintf('<b class="q$1">$2</b>',ac,X+ab)+W});l=l.replace(/(<!--ndstart-->)(.*)(<!--ndend-->)/,function(Z,X,W,aa){if(!N.namedesc){return X+aa}if(!N.namedesccolor){return Z}var Y=parseInt(N.namedesccolor).toString(16);while(Y.length<6){Y="0"+Y}return X+$WH.sprintf('<br /><span style="color: $1">$2</span>',"#"+Y,N.namedesc)+aa});var J=g_items[x].jsonequip.nsockets|0;if((!J&&N.nsockets)||(J&&N.nsockets>J)){l=l.replace(/<!--ps-->(<br(?: \/)?>)?/,function(ac,ae){var Y="";for(var aa=J;aa<N.nsockets;++aa){if(!N["socket"+(aa+1)]){continue}var ab=N["socket"+(aa+1)];var X="socket-unknown";var Z=81;var W=ab;switch(ab){case 1:X="socket-meta";Z=81;W=1;break;case 2:X="socket-red";Z=81;W=2;break;case 3:X="socket-yellow";Z=81;W=3;break;case 4:X="socket-blue";Z=81;W=4;break;case 5:X="socket-hydraulic";Z=81;W=5;break;case 6:X="socket-cogwheel";Z=81;W=6;break;case 7:X="socket-prismatic";Z=81;W=9;break;case 8:X="socket-relic-iron";Z=225;W=64;break;case 9:X="socket-relic-blood";Z=225;W=128;break;case 10:X="socket-relic-shadow";Z=225;W=256;break;case 11:X="socket-relic-fel";Z=225;W=512;break;case 12:X="socket-relic-arcane";Z=225;W=1024;break;case 13:X="socket-relic-frost";Z=225;W=2048;break;case 14:X="socket-relic-fire";Z=225;W=4096;break;case 15:X="socket-relic-water";Z=225;W=8192;break;case 16:X="socket-relic-life";Z=225;W=16384;break;case 17:X="socket-relic-storm";Z=225;W=32768;break;case 18:X="socket-relic-holy";Z=225;W=65536;break;default:break}var ad=$WH.sprintf('<a href="/items/gems?filter=$1;$2;0" class="$3 q0">',Z,W,X);ad+=g_socket_names[ab]?g_socket_names[ab]:(g_gem_types[ab]?$WH.sprintf(LANG.tooltip_emptyrelicslot.replace("%s","$1"),g_gem_types[ab]):"Unknown Socket");ad+="</a>";Y+="<br>"+ad}return(J==0?"<br>":"")+Y+"<br><br>"})}if($WH.g_applyStatModifications&&$WH.g_applyStatModifications.ScalingData){var f;var b=/(<!--pts(\d):(\d):(\d+(?:\.\d+)?):(\d+):(\d+(?:\.\d+)?)(:crm)?-->(?:<!--rtg\d+-->)?)(\d+(?:\.\d+)?)(<!---->(%?))?/g;while((f=b.exec(l))!==null){var T=parseFloat(f[6]);var H=$WH.g_applyStatModifications.ScalingData.SV;var L=H[N.level];var j=0;var z=N.quality;var c=1;if(f[7]==":crm"){z=3;c=v}switch(z){case 5:case 4:case 7:case 3:j=1;break;case 2:j=2;break;default:break}var r=j*5;var q=L[r]?L[r]:0;var M=(T*q*c).toFixed((f[10]=="%")?2:0);l=l.replace(f[0],f[1]+M+(f[9]?f[9]:""))}}var D=0;switch(w){case $WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL:D=70;break;case $WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL:D=80;break;case $WH.g_applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL:D=85;break;default:break}if(D){l=l.replace(/<!--ee(\d+):(\d+):(\d+):(\d+):(\d+):(\d+)-->([^<]*)<\/span>/gi,function(W,af,aa,Z,ae,ac,ab,ad){var X={enchantment:ad,scalinginfo:{scalingcategory:af,minlvlscaling:aa,maxlvlscaling:Z,damage1:ae/1000,damage2:ac/1000,damage3:ab/1000}};var Y=$WH.g_scaleItemEnchantment(X,D);return"<!--ee-->"+Y+"</span>"})}l=l.replace(/(<!--rtg%(\d+)-->)([\.,0-9]+)%?/g,function(Z,W,aa,X){V=l.match(new RegExp("<!--rtg"+aa+"-->([\\d\\.,]+)(-[\\d\\.,]+)?"));if(!V){return Z}if(V[2]){V[2]=V[2].replace(/\D/,"")}V[1]=V[1].replace(/\D/,"");var Y=V[2]?((Math.abs(parseInt(V[2]))+parseInt(V[1]))/2):V[1];return W+(V[2]?"~":"")+(Math.round($WH.g_convertRatingToPercent(d?d:$WH.g_max_level,aa,Y)*100)/100)+(aa!=49?"%":"")});return l};$WH.g_setTooltipLevel=function(f,a,q){var u=typeof f;if(u=="number"){var b=$WH.g_getDataSource();if(b[f]&&b[f][(q?"buff_":"tooltip_")+Locale.getName()]){f=b[f][(q?"buff_":"tooltip_")+Locale.getName()]}else{return f}}else{if(u!="string"){return f}}f=f.replace(/<!--(gem|ee)(\d+):(\d+):(\d+):(\d+):(\d+):(\d+)-->([^<]*)<\/span>/gi,function(j,E,D,y,x,C,B,z,A){var v={enchantment:A,scalinginfo:{scalingcategory:D,minlvlscaling:y,maxlvlscaling:x,damage1:C/1000,damage2:B/1000,damage3:z/1000}};var w=$WH.g_scaleItemEnchantment(v,a);return"<!--"+E+"-->"+w+"</span>"});u=f.match(/<!--i?\?([0-9-:]*)-->/);if(!u){return f}u=u[1].split(":");var a=Math.min(parseInt(u[2]),Math.max(parseInt(u[1]),a)),r=parseInt(u[4])||0;if(r){if(!f.match(/<!--pts\d:\d:\d+(?:\.\d+)?:\d+-->/g)&&!(r<0)){f=$WH.g_setItemModifications(f,parseInt(u[0]),null,null,a);$WH.updateItemStringLink.call(this)}else{if(r>0){if(!parseInt(u[7])&&$WH.isset("g_pageInfo")&&g_pageInfo.type==3&&g_items[g_pageInfo.typeId]&&g_items[g_pageInfo.typeId].quality!=7){a=Math.min(g_items[g_pageInfo.typeId].reqlevel,a)}var k={};if(g_pageInfo.type==6){k=(g_spells[g_pageInfo.typeId]&&g_spells[g_pageInfo.typeId].effectScaling)||{}}var p={scadist:r};$WH.g_setJsonSpellLevel(p,a,k);f=f.replace(/<!--cast-->\d+\.\d+/,"<!--cast-->"+p.cast);var g;var d=/<!--\?\+\+(\d+):(\d+)-->/g;while((g=d.exec(f))!==null){var h=parseInt(g[1]);var s=parseInt(g[2]);var k=(g_spells[h]&&g_spells[h].effectScaling)||{};p[h]={scadist:s};$WH.g_setJsonSpellLevel(p[h],a,k)}if(p.effects){f=$WH.g_adjustSpellPoints(f,p);if(this.modified){for(var c in this.modified[1]){var t=this.modified[1][c];for(var n=0;n<t.length;++n){t[n][0]=$WH.g_adjustSpellPoints(t[n][0],p);t[n][1]=$WH.g_adjustSpellPoints(t[n][1],p)}}}}}else{var l=-r;var e=$WH.g_getSpellScalingValue(l,a);for(var o=0;o<3;++o){var m=u[5+o]/1000;f=f.replace(new RegExp("<!--gem"+(o+1)+"-->(.+?)<"),"<!--gem"+(o+1)+"-->"+Math.round(e*m)+"<")}}}}f=f.replace(/<!--ppl(\d+):(\d+):(\d+):(\d+)-->\s*\d+/gi,function(w,j,v,x,y){return"<!--ppl"+j+":"+v+":"+x+":"+y+"-->"+Math.round(parseInt(x)+(Math.min(Math.max(a,j),v)-j)*y/100)});f=f.replace(/(<!--rtg%(\d+)-->)([\.0-9]+)%?/g,function(w,j,x,v){u=f.match(new RegExp("<!--rtg"+x+"-->(\\d+)"));if(!u){return w}return j+(Math.round($WH.g_convertRatingToPercent(a,x,u[1])*100)/100)+(x!=49?"%":"")});f=f.replace(/(<!--i?\?\d+:\d+:\d+:)\d+/g,"$1"+a);f=f.replace(/<!--lvl-->\d+/g,"<!--lvl-->"+a);return f};$WH.g_getSpellScalingValue=function(b,c){var a=$WH.g_convertScalingSpell?$WH.g_convertScalingSpell.SV:null;if(!a){return 0}return a[c][b-1]};$WH.g_adjustSpellPoints=function(c,b){for(var a=1;a<4;++a){c=c.replace(new RegExp("<!--pts"+a+":0:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,f,e){var d=(b[f]&&b[f].hasOwnProperty("effects"))?b[f].effects[a]:b.effects[a];if(!d){return g}return"<!--pts"+a+":0:0:"+f+"-->"+(e?e:"")+(d.min==d.max?d.avg:d.min+" to "+d.max)+"<"});c=c.replace(new RegExp("<!--pts"+a+":1:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,f,e){var d=(b[f]&&b[f].hasOwnProperty("effects"))?b[f].effects[a]:b.effects[a];if(!d){return g}return"<!--pts"+a+":1:0:"+f+"-->"+(e?e:"")+d.min+"<"});c=c.replace(new RegExp("<!--pts"+a+":2:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,f,e){var d=(b[f]&&b[f].hasOwnProperty("effects"))?b[f].effects[a]:b.effects[a];if(!d){return g}return"<!--pts"+a+":2:0:"+f+"-->"+d.max+"<"});c=c.replace(new RegExp("<!--pts"+a+":3:(\\d+(?:\\.\\d+)?):(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(h,g,f,e){var d=(b[f]&&b[f].hasOwnProperty("effects"))?b[f].effects[a]:b.effects[a];if(!d){return h}return"<!--pts"+a+":3:"+g+":"+f+"-->"+(e?e:"")+Math.round(d.avg*g)+"<"});c=c.replace(new RegExp("<!--pts"+a+":4:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,f,e){var d=(b[f]&&b[f].hasOwnProperty("effects"))?b[f].effects[a]:b.effects[a];if(!d){return g}return"<!--pts"+a+":4:0:"+f+"-->"+(e?e:"")+d.pts+"<"})}return c};$WH.g_roundArtifactPower=function(b){var a=1;if(b>50){a=5}if(b>1000){a=25}if(b>5000){a=50}return $WH.g_roundHalfEven(b/a)*a};$WH.g_roundHalfEven=function(b){if(Math.floor(b*100000)%100000==50000){var a=Math.floor(b);return a+a%2}return Math.round(b)};$WH.g_setTooltipSpells=function(h,e,g,c){var l={},j="<!--sp([0-9]+):[01]-->.*?<!--sp\\1-->",d;if(e==null){e=[]}if(c==null){c={}}for(var b=0;b<e.length;++b){l[e[b]]=1}if(d=h.match(new RegExp(j,"g"))){for(var b=0;b<d.length;++b){var a=d[b].match(j)[1];l[a]=(l[a]|0);if(c[a]==null){c[a]=-1}c[a]++;if(g[a]==null||g[a][c[a]]==null||g[a][c[a]][l[a]]==null){continue}var f=g[a][c[a]][l[a]];f=$WH.g_setTooltipSpells(f,e,g,c);if(l[a]&&!g[a][c[a]][0]&&(b<(d.length-1))&&(h.indexOf(d[b]+d[b+1])!=-1)){var k=d[b+1].match(j)[1];l[k]=(l[k]|0);h=h.replace(d[b+1],"<!--sp"+k+":"+l[k]+"-->"+f+"<!--sp"+k+"-->");continue}h=h.replace(d[b],"<!--sp"+a+":"+l[a]+"-->"+f+"<!--sp"+a+"-->")}}return h};$WH.g_enhanceTooltip=function(p,o,D,O,r,f,R,k,K,v,d,F,q,E){if((!$WH.g_applyStatModifications||!$WH.g_applyStatModifications.ScalingData)&&(E||k)){g_itemScalingCallbacks.push((function(U){return function(){var V=$WH.g_enhanceTooltip.call(U,p,o,D,O,r,f,R,k,K,v,d,F,q,E);$WH.updateTooltip.call(U,V)}})(this));return LANG.tooltip_loading}var T=typeof p,c,I;var s=$WH.g_getDataSource();var l=$WH.isset("g_pageInfo")?g_pageInfo.type:null;I=$WH.isset("g_pageInfo")?g_pageInfo.typeId:null;this._knownSpells=f;if(T=="number"){I=p;var m="tooltip_";if(r){m="buff_"}if(F){m="tooltip_premium_"}if(q){m="text_"}if(s[I]&&s[I][m+Locale.getName()]){p=s[I][m+Locale.getName()];c=s[I][(r?"buff":"")+"spells_"+Locale.getName()];this._rppmModList=s[I]["rppmmod"];if(c){p=$WH.g_setTooltipSpells(p,f,c)}}else{return p}}else{if(T!="string"){return p}}if(D){var Q=$WH.g_getGets();if(Q.lvl){p=$WH.g_setTooltipLevel(p,Q.lvl,r)}}if((E||k)&&I){p=$WH.g_setItemModifications(p,I,E,k,this._selectedLevel?this._selectedLevel:null)}if(o){p=p.replace(/\(([^\)]*?<!--lvl-->[^\(]*?)\)/gi,function(V,U){return'(<a href="javascript:;" onmousedown="return false" class="tip" style="color: white; cursor: pointer" onclick="$WH.g_staticTooltipLevelClick(this, null, 0)" onmouseover="$WH.Tooltip.showAtCursor(event, \'<span class=\\\'q2\\\'>\' + LANG.tooltip_changelevel + \'</span>\')" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()">'+U+"</a>)"});if(p.indexOf("<!--artpow:")>0){if(!this.hasOwnProperty("_knowledgeLevel")){var x=/(&|\?)artk=(\d+)/.exec(location.href);if(x&&parseInt(x[2])<=g_artifact_knowledge_max_level){this._knowledgeLevel=parseInt(x[2])}}var w=this._knowledgeLevel?parseInt(this._knowledgeLevel):0;var z=1825;p=p.replace(/(<!--ndstart-->)?<!--ndend-->/i,function(V,U){return(U?U+"<br />":" ")+'<a href="javascript:;" onmousedown="return false" class="tip" style="color: white; cursor: pointer" onclick="$WH.g_staticTooltipKnowledgeLevelClick(this, null, '+I+')" onmouseover="$WH.Tooltip.showAtCursor(event, \'<span class=\\\'q2\\\'>\' + LANG.tooltip_changelevel + \'</span>\')" onmousemove="$WH.Tooltip.cursorUpdate(event)" onmouseout="$WH.Tooltip.hide()">'+$WH.sprintf(LANG.tooltip_knowledgeformat.replace("%d","$1"),w)+"</a>"});p=p.replace(/(<!--artpow:(\d+)-->)[\d\.\,]+/,function(V,U,W){return U+$WH.number_locale_format($WH.g_roundArtifactPower(parseInt(W)*$WH.g_getCurveValue(z,w)))})}}if(O&&Slider){var g=$WH.g_groupSizeScalingShouldShow(I);if(r){r.bufftip=this;if(g&&$WH.isset("g_difficulties")&&g_difficulties[g]){p=$WH.g_groupSizeScalingOnChange.call(r,this,g_difficulties[g].maxplayers,1,true)}}else{var e=new RegExp("<!--"+((l&&l==3)?"i":"")+"\\?(\\d+):(\\d+):(\\d+):(\\d+)");var M=p.match(e);if(g&&$WH.isset("g_difficulties")&&g_difficulties[g]){var J=$WH.ce("label");J.innerHTML=LANG.tooltip_difficulty+": ";this._difficultyBtn=$WH.ce("a");this._difficultyBtn.ttId=I;$WH.g_difficultyBtnBuildMenu.call(this,I);Menu.add(this._difficultyBtn,this._difficultyBtn.menu);$("#dd"+I).append(J).append(this._difficultyBtn);$WH.g_difficultyBtnOnChange.call(this,g);p=$WH.g_groupSizeScalingOnChange.call(this,this,g_difficulties[g].maxplayers,0,true)}else{if(M){if(M[2]!=M[3]){this.slider=Slider.init(O,{minValue:parseInt(M[2]),maxValue:parseInt(M[3]),onMove:$WH.g_tooltipSliderMove.bind(this)});Slider.setValue(this.slider,parseInt(M[4]));this.slider.onmouseover=function(U){$WH.Tooltip.showAtCursor(U,LANG.tooltip_changelevel2,0,0,"q2")};this.slider.onmousemove=$WH.Tooltip.cursorUpdate;this.slider.onmouseout=$WH.Tooltip.hide;this.slider.input.onmouseover=function(U){$WH.Tooltip.showAtCursor(U,LANG.tooltip_changelevel,0,0,"q2")};this.slider.input.onmousemove=$WH.Tooltip.cursorUpdate;this.slider.input.onmouseout=$WH.Tooltip.hide}}}}}if(R){if(r&&r.modified){r.bufftip=this}else{for(var P in c){if(!g_spells[P]||$WH.in_array(f,P)!=-1){continue}$(R).append('<input type="checkbox" id="known-'+P+'" />').append('<label for="known-'+P+'"><a rel="spell='+P+"&know="+P+'">'+g_spells[P]["name_"+Locale.getName()]+(g_spells[P]["rank_"+Locale.getName()]?" ("+g_spells[P]["rank_"+Locale.getName()]+")":"")+"</a></label>").append("<br />");$("#known-"+P).change($WH.g_tooltipSpellsChange.bind(this))}}this.modified=[R,c,f];$(R).toggle(!$(R).is(":empty"))}if(d){var a=p.match(/<!--rppm-->(\d+(?:\.\d+)?)<!--rppm-->/);if(a){var j=$("#rppm"+I);if(this._rppmModList.hasOwnProperty(4)){this._rppmModBase=parseFloat(a[1]);if(j.is(":empty")){this._rppmSpecModList=this._rppmModList[4];this._rppmSpecModList.splice(0,0,{spec:-1,modifiervalue:0,filename:""});j.append(g_getMajorHeading(LANG.realppmmodifiers,2,3));for(var P in this._rppmSpecModList){var n=Icon.create(this._rppmSpecModList[P]["filename"],0,null);n.style.display="inline-block";n.style.verticalAlign="middle";var h=$('<input name="rppmmod" type="radio" id="rppm-'+P+'" />');h.get(0).checked=(this._rppmSpecModList[P]["spec"]==-1);j.append(h).append(this._rppmSpecModList[P]["spec"]==-1?"":n).append('<label for="rppm-'+P+'"> <a>'+(this._rppmSpecModList[P]["spec"]==-1?LANG.finone:g_chr_specs[this._rppmSpecModList[P]["spec"]])+"</a></label>").append("<br />");var L=this;$("#rppm-"+P).change(function(){$WH.g_tooltipRPPMChange.call(this,L)})}}else{var u=this._rppmModBase;var y=this._rppmSpecModList;p=p.replace(/<!--rppm-->(\[?)(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(U,X,W,V){return"<!--rppm-->"+X+(u*(1+parseFloat(y[$('input[name="rppmmod"]:checked',j).attr("id").match(/\d+$/)[0]].modifiervalue))).toFixed(2)+V+"<!--rppm-->"})}}j.toggle(!(j.is(":empty")));var t="";if(this._rppmModList.hasOwnProperty(1)){t+=" + "+LANG.traits.hastertng[2]}else{if(this._rppmModList.hasOwnProperty(2)){t+=" + "+LANG.traits.critstrkrtng[2]}}if(g_pageInfo.type==6&&this._rppmModList.hasOwnProperty(6)){t+=" + Budget"}if(t.length>0){p=p.replace(/<!--rppm-->\[?(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(U,W,V){return"<!--rppm-->["+W+t+"]"+V+"<!--rppm-->"})}}}if(v){for(P=1;P<=K;++P){$(v).append('<input type="checkbox" id="item-upgrade-'+P+'" />').append('<label for="item-upgrade-'+P+'"><a>'+$WH.sprintf(LANG.itemupgrade_format,P)+"</a></label>").append("<br />");$("#item-upgrade-"+P).change($WH.g_upgradeItemTooltip.bind(this,v,P))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_pvp")){$(v).append('<input type="checkbox" id="item-upgrade-pvp" />').append('<label for="item-upgrade-pvp"><a>'+LANG.su_menu_pvpmode+"</a></label>").append("<br />");$("#item-upgrade-pvp").change($WH.g_upgradeItemTooltip.bind(this,v,"pvp"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_chal")){$(v).append('<input type="checkbox" id="item-upgrade-chal" />').append('<label for="item-upgrade-chal"><a>'+LANG.su_menu_challengemode+"</a></label>").append("<br />");$("#item-upgrade-chal").change($WH.g_upgradeItemTooltip.bind(this,v,"chal")).next().mouseover(function(U){$WH.Tooltip.showAtCursor(U,LANG.challengemodescaling_tip)}).mousemove($WH.Tooltip.cursorUpdate).mouseout($WH.Tooltip.hide)}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twtbc")){$(v).append('<input type="checkbox" id="item-upgrade-twtbc" />').append('<label for="item-upgrade-twtbc"><a>'+g_difficulty_names[24]+" "+LANG.su_note_bc+"</a></label>").append("<br />");$("#item-upgrade-twtbc").change($WH.g_upgradeItemTooltip.bind(this,v,"twtbc"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twwotlk")){$(v).append('<input type="checkbox" id="item-upgrade-twwotlk" />').append('<label for="item-upgrade-twwotlk"><a>'+g_difficulty_names[24]+" "+LANG.su_note_wotlk+"</a></label>").append("<br />");$("#item-upgrade-twwotlk").change($WH.g_upgradeItemTooltip.bind(this,v,"twwotlk"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twcata")){$(v).append('<input type="checkbox" id="item-upgrade-twcata" />').append('<label for="item-upgrade-twcata"><a>'+g_difficulty_names[24]+" "+LANG.su_note_cata+"</a></label>").append("<br />");$("#item-upgrade-twcata").change($WH.g_upgradeItemTooltip.bind(this,v,"twcata"))}$(v).toggle(!$(v).is(":empty"))}if(l==3){var H=$("#cs"+I);if(H&&$WH.g_classSpecBtnShouldShow(p)){if(!this._classSpecBtn){var G=$WH.ce("label");G.innerHTML=LANG.tooltip_showingtooltipfor+" ";this._classSpecBtn=$WH.ce("a");this._classSpecBtn.ttId=I;$WH.g_classSpecBtnBuildMenu.call(this,s[I].hasOwnProperty("validMenuSpecs")?s[I].validMenuSpecs:false);Menu.add(this._classSpecBtn,this._classSpecBtn.menu);H.append(G).append(this._classSpecBtn).show()}var C=$WH.localStorage.get("tooltips_class:spec");C=C?C.split(":"):null;var A=/(&|\?)spec=(\d+)/.exec(location.href);var S,B;if(A){S=A[2];B=$WH.g_getClassFromSpec(S);if(B){C=[B,S]}}if(C&&C.length==2){p=$WH.g_classSpecBtnOnChange.call(this,C[0],C[1],p,true)}else{$(this._classSpecBtn).text(LANG.tooltip_chooseaspec)}}}if(s[I]&&$WH.g_bonusesBtnShouldShow(s[I].bonusesData)){var b=$("#bs"+I);if(b&&!this._bonusesBtn){var N=$WH.ce("label");N.innerHTML=LANG.tooltip_itembonuses+": ";this._bonusesBtn=$WH.ce("a");this._bonusesBtn.ttId=I;$WH.g_bonusesBtnBuildMenu.call(this,s[I]);Menu.add(this._bonusesBtn,this._bonusesBtn.menu);$(this._bonusesBtn).text(LANG.selectbonus);b.append(N).append(this._bonusesBtn).show();if(E!==""){$WH.g_bonusesBtnOnChange.call(this,E,true)}}}if(l==3){$WH.updateItemStringLink.call(this)}return p};$WH.g_evalPlayerCondition=function(g,j){switch(j.id){case 34116:j.achievementLogic=6;j.achievement_2=6566;break;case 34647:case 34645:j.achievementLogic=65536;j.achievement_0=6566;break;case 34648:j.achievementLogic=65537;j.achievement_1=6566;break;case 33788:case 33790:j.prevquest1=38445;j.prevquest2=37935;break;default:break}if(j.minLevel&&g.level<j.minLevel){return false}if(j.maxLevel&&g.level>j.maxLevel){return false}if(j.raceMask&&!((1<<(g.race-1))&j.raceMask)){return false}if(j.classMask&&!((1<<(g["class"]-1))&j.classMask)){return false}if(typeof j.gender!="undefined"&&j.gender!=-1&&g.gender!=j.gender){return false}if(j.minAvgItemLevel&&g.items&&j.minAvgItemLevel>g.items.averageItemLevel){return false}if(j.maxAvgItemLevel&&g.items&&j.maxAvgItemLevel<g.items.averageItemLevel){return false}if(j.minAvgEquippedItemLevel&&g.items&&j.minAvgEquippedItemLevel>g.items.averageItemLevelEquipped){return false}if(j.maxAvgEquippedItemLevel&&g.items&&j.maxAvgEquippedItemLevel>g.items.averageItemLevelEquipped){return false}if(j.skillID_0&&g.professions){var b={};for(var a in g.professions.primary){b[g.professions.primary[a].id]=parseInt(g.professions.primary[a].rank)}for(var a in g.professions.secondary){b[g.professions.secondary[a].id]=parseInt(g.professions.secondary[a].rank)}if(!$WH.g_evalComplexCondition(j.skillLogic,function(c){return b[j["skillID_"+c]]&&(!j["minSkill_"+c]||b[j["skillID_"+c]]>=j["minSkill_"+c])&&(!j["maxSkill_"+c]||b[j["skillID_"+c]]<=j["maxSkill_"+c])})){return false}}if(j.time_0&&j.time_1){var h=$WH.g_decodeBlizzDate(j.time_0);var f=$WH.g_decodeBlizzDate(j.time_1);if(j.id==34518){h=new Date(h.getTime()-24*3600*1000);f=new Date(h.getTime()-24*3600*1000)}if(g_serverTime<h||g_serverTime>f){return false}}if(j.worldStateExpressionID&&$WH.g_worldStateExpressionToEvent[j.worldStateExpressionID]){if(!$WH.isset("g_events")){return false}var d=g_events[$WH.g_worldStateExpressionToEvent[j.worldStateExpressionID]];if(!d){return false}var e=$WH.g_getEventNextDates(d);if(!e[0]||!e[1]||g_serverTime<e[0]||g_serverTime>e[1]){return false}}if(j.prevquest0&&g.quests){if(!$WH.g_evalComplexCondition(j.prevquestlogic,function(c){return $WH.in_array(g.quests,j["prevquest"+c])!=-1})){return 0}}if(j.achievement_0&&g.achievements){if(!$WH.g_evalComplexCondition(j.achievementLogic,function(c){return $WH.in_array(g.achievements.achievementsCompleted,j["achievement_"+c])!=-1})){return 0}}return true};$WH.g_worldStateExpressionToEvent={1368:141,2941:321,3555:341,4546:372,6572:404,11286:479,17483:559,17484:562,18046:587,17485:561,17486:563,17499:560,17500:564,17503:565,17567:566};$WH.g_evalComplexCondition=function(b,j){var d=(b>>16)&15;var a=(b>>0)&255;var h=j(0);h=(d&1)?!h:h;var e=0;opLoop:while(e<3){var g=j(e+1);var c=(d>>(e+1))&1;g=c?!g:g;var f=(a>>(e*2))&3;switch(f){case 0:break opLoop;case 1:h=h&&g;break;case 2:h=h||g;break}++e}return h};$WH.g_decodeBlizzDate=function(b){var e=new Date();var d=b&63;var l=(b>>6)&31;var j=(b>>20)&15;var k=(b>>14)&63;var f=(b>>24)&31;e.setMinutes(d==63?0:d,0,0);e.setHours(l==31?0:l);e.setFullYear(1900+(f==31?0:(f+100)),j==15?0:j,k==63?1:(k+1));var a=e.getTime();var h=7*24*3600*1000;var c=0;if(h>0){c=Math.ceil((g_serverTime.getTime()-a)/h)*h}var g=new Date();g.setTime(a+c);return g};$WH.g_getEventNextDates=function(a,n){if(n==null){n=g_serverTime}var l=null;var c=null;if(a.dates[0]==""&&a.startDate){a.dates[0]=a.startDate}var j=a.duration0?a.duration0:0;var k=a.duration1?a.duration1:0;var o=a.filtertype?a.filtertype:0;var p=0;for(var h=0;h<a.dates.length;++h){if(a.dates[h]&&a.dates[h]!=""){++p}}if(p>0){if(p>1){for(var h=0;h<a.dates.length;++h){if(!a.dates[h]||a.dates[h]==""){continue}var b=new Date(a.dates[h]).getTime();var f;if(k){b+=j*3600*1000;f=b+k*3600*1000}else{f=b+j*3600*1000}if(n.getTime()<f||(h==a.dates.length-1)){l=new Date();l.setTime(b);c=new Date();c.setTime(f);break}}}else{if(o==-1){if(a.rec&&a.rec==-2){l=new Date(a.dates[0]);c=new Date();c.setTime(l.getTime()+j*3600*1000)}else{var b=new Date(a.dates[0]);for(var h=0;h<2;++h){var g=new Date(n.getFullYear()+h,b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds()).getTime();var d;if(k){g+=j*3600*1000;d=g+k*3600*1000}else{d=g+j*3600*1000}if(n.getTime()<d){l=new Date();l.setTime(g);c=new Date();c.setTime(d);break}}}}else{var b=new Date(a.dates[0]).getTime();if(a.id==301){b-=24*3600*1000}var f=b+j*3600*1000;var m=0;if(k>0){m=k*3600*1000}else{switch(o){case 0:m=7*24*3600*1000;break;default:break}}var e=0;if(m>0){e=Math.ceil((n.getTime()-f)/m)*m}l=new Date();l.setTime(b+e);c=new Date();c.setTime(f+e)}}}return[l,c]};$WH.g_groupSizeScalingShouldShow=function(c){if($WH.isset("g_difficulties")&&$WH.isset("g_spells")&&g_spells[c]&&g_spells[c].effects&&g_spells[c].effects.length>0){for(var b=0;b<g_spells[c].effects.length;++b){for(var a in g_spells[c].effects[b]){if(g_spells[c].effects[b].hasOwnProperty(a)){return a}}}}return false};$WH.g_groupSizeScalingSliderMove=function(c,b,a){$WH.g_groupSizeScalingOnChange.call(this,this,a.value,0);if(this.bufftip){$WH.g_groupSizeScalingOnChange.call(this,this.bufftip,a.value,1)}$WH.Tooltip.hide()};$WH.g_groupSizeScalingOnChange=function(l,g,s,q){while(l.className.indexOf("tooltip")==-1){l=l.parentNode}g=parseInt(g);if(isNaN(g)){return}var a=$WH.g_getDataSource();var f=$WH.isset("g_pageInfo")?g_pageInfo.typeId:null;if(a[f]&&a[f].effects&&a[f].effects.length>0){var j=a[f][(s?"buff_":"tooltip_")+Locale.getName()];var d=this._difficultyBtn.selectedDD;this._difficultyBtn.selectedPlayers=g;var b={effects:{}};var c=false;for(var o=0;o<a[f].effects.length;++o){var t=a[f].effects[o][d]?a[f].effects[o][d]:(a[f].effects[o][14]?a[f].effects[o][14]:(a[f].effects[o][1]?a[f].effects[o][1]:null));if(t){c=true;var u=b.effects[o+1]={};var n=t.basepoints+(t.randompoints!=0?1:0);var p=t.basepoints+t.randompoints;var k=g_difficulties[d];var r=k.minplayers;var e=k.maxplayers;if(r<e&&g>r&&t.groupmod>1){if(e<g){g=e}var h=(g-r)/(e-r);var m=t.groupmod-1;n+=n*m*h;p+=p*m*h}u.avg=Math.round((n+p)/2);u.min=Math.round(n);u.max=Math.round(p)}}if(c){j=$WH.g_adjustSpellPoints(j,b);if(q){return j}$WH.updateTooltip.call(l,j)}}};$WH.g_difficultyBtnBuildMenu=function(g){var e=[];var a=g_spells[g];var f={};for(var d=0;d<a.effects.length;++d){for(var b in a.effects[d]){var c=[b,g_difficulty_names[b],$WH.g_difficultyBtnOnChange.bind(this,b)];if(a.effects[d].hasOwnProperty(b)&&!f[b]){e.push(c);f[b]=true}}}this._difficultyBtn.menu=e};$WH.g_difficultyBtnOnChange=function(b){this._difficultyBtn.selectedDD=b;$(this._difficultyBtn).text("");$WH.array_walk(this._difficultyBtn.menu,function(h){h.checked=false});var g=Menu.findItem(this._difficultyBtn.menu,[b]);g.checked=true;$(this._difficultyBtn).text(g[MENU_IDX_NAME]);var d=this._difficultyBtn.selectedPlayers;var e=g_difficulties[b].minplayers,a=g_difficulties[b].maxplayers,c=g_difficulties[b].maxplayers;if(d){if(d>a){c=a}else{if(d<e){c=e}else{c=d}}}var f=$("#sl"+this._difficultyBtn.ttId);f.html("").hide();this.slider=null;if(e!=a){f.show();this.slider=Slider.init(f.get(0),{minValue:parseInt(e),maxValue:parseInt(a),onMove:$WH.g_groupSizeScalingSliderMove.bind(this)});Slider.setValue(this.slider,parseInt(c));this.slider.onmouseover=function(h){$WH.Tooltip.showAtCursor(h,LANG.tooltip_changeplayers2,0,0,"q2")};this.slider.onmousemove=$WH.Tooltip.cursorUpdate;this.slider.onmouseout=$WH.Tooltip.hide;this.slider.input.onmouseover=function(h){$WH.Tooltip.showAtCursor(h,LANG.tooltip_changeplayers,0,0,"q2")};this.slider.input.onmousemove=$WH.Tooltip.cursorUpdate;this.slider.input.onmouseout=$WH.Tooltip.hide}$WH.g_groupSizeScalingSliderMove.call(this,null,null,{value:c})};$WH.g_classSpecBtnShouldShow=function(a){var c=/<span[^>]*?><!--stat(\d+)-->([-+][\d\.,]+(?:-[\d\.,]+)?\D*?)<\/span>/gi;var b=c.exec(a);while(b!=null){if(g_grayedOutStats.hasOwnProperty(b[1])||($WH.in_array(g_specDependantStats,b[1])!=-1)){return true}b=c.exec(a)}if(a.indexOf("<!--traitspec")>0){return true}return false};$WH.g_classSpecBtnOnChange=function(d,j,f,h){d=parseInt(d);j=parseInt(j);$(this._classSpecBtn).html("");this._classSpecBtn.selectedSpec=j;var e=$("<span></span>");e.text($WH.sprintf(" $1 $2",g_chr_specs[j],g_chr_classes[d]));var c=Menu.findItem(this._classSpecBtn.menu,[d,j]);if(c&&c[MENU_IDX_OPT]&&c[MENU_IDX_OPT].tinyIcon){var a=c[MENU_IDX_OPT].tinyIcon;var g=Icon.create(a,0,null,"javascript:;");g.style.display="inline-block";g.style.verticalAlign="middle";$(this._classSpecBtn).append(g)}$(this._classSpecBtn).append(e);if(!h){$WH.localStorage.set("tooltips_class:spec",d+":"+j)}var b=f?f:this.innerHTML;b=b.replace(/<span[^>]*?><!--stat(\d+)-->([-+][\d\.,]+(?:-[\d\.,]+)?)(\D*?)<\/span>/gi,function(o,l,q,k){var n=l==50?' class="q2"':"";if(g_grayedOutStats[l]&&(g_grayedOutStats[l].indexOf(j)!=-1)){n=' style="color:gray"'}if($WH.in_array(g_specDependantStats,l)!=-1){var p=$WH.g_getRealStatIdForSpec(l,g_specPrimaryStatOrders[j],g_specPrimaryStatOrders[j].length);var m=$WH.g_statToJson[p];if(m&&LANG.traits[m]){k=" "+LANG.traits[m][1]}}return"<span"+n+"><!--stat"+l+"-->"+q+k+"</span>"});b=b.replace(/<!--scstart(\d+):(\d+)--><span class="q(\d+)">(<!--asc\d+-->)?(.*?)<\/span><!--scend-->/i,function(q,n,o,m,p,l){m=1;var r=n==2&&(!g_classes_allowed_weapon[d]||$WH.in_array(g_classes_allowed_weapon[d],o)==-1);var k=n==4&&(!g_classes_allowed_armor[d]||$WH.in_array(g_classes_allowed_armor[d],o)==-1);if(r||k){m=10}return"<!--scstart"+n+":"+o+'--><span class="q'+m+'">'+(p?p:"")+l+"</span><!--scend-->"});b=b.replace(/(<!--traitspecstart:(\d+)(?::(\d+))?-->)[\w\W]*?(<!--traitspecend-->)/g,function(o,n,k,m,l){var p="";if($WH.isset("g_pageInfo")&&g_pageInfo.hasOwnProperty("typeId")&&g_pageInfo.type==3&&g_items.hasOwnProperty(g_pageInfo.typeId)&&g_items[g_pageInfo.typeId].hasOwnProperty("affectsArtifactPowerTypesData")&&g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData.hasOwnProperty(k)&&g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData[k].hasOwnProperty(j)){p=g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData[k][j]}else{if(m){p='<span style="color: #00FF00">'+$WH.sprintf(LANG["tooltip_relicrank"+(m>1?"s":"")+"increase"].replace("%d","$1"),m)+": </span>"+LANG.tooltip_relicminortrait}}return n+p+l});if(window.history){if(location.pathname.indexOf("&spec")!=-1){window.history.replaceState({},"",location.pathname.replace(/&spec=\d+/,"&spec="+j)+location.hash)}else{if(!location.hash){window.history.replaceState({},"",location.pathname+"&spec="+j)}else{window.history.replaceState({},"",location.pathname+"&spec="+j+location.hash)}}}if(f){return b}else{this.innerHTML=b}};$WH.g_classSpecBtnBuildMenu=function(a){var b=[[,LANG.tooltip_chooseaspec]];var o=Menu.findItem(mn_spells,[-12]);b=b.concat($.extend(true,[],o[MENU_IDX_SUB]));for(var h in g_chr_specs_by_class){var e=g_chr_specs_by_class[h];var k=null;for(var n in b){var m=b[n];if(m[MENU_IDX_ID]==h){if(m[MENU_IDX_URL]){m[MENU_IDX_URL]=null}k=n;break}}if(k==null){continue}for(var g in e){var f=b[k][MENU_IDX_SUB];for(var d in f){var c=f[d];if(c[MENU_IDX_ID]==e[g]){if(a&&($WH.in_array(a,e[g])<0)){delete c[MENU_IDX_OPT].tinyIcon;c[MENU_IDX_OPT].className="q0";c[MENU_IDX_URL]="javascript:;"}else{c[MENU_IDX_URL]=$WH.g_classSpecBtnOnChange.bind(this,h,e[g],false)}break}}}}this._classSpecBtn.menu=b};$WH.g_getClassFromSpec=function(d){for(var c in g_chr_specs_by_class){if(!g_chr_specs_by_class.hasOwnProperty(c)){continue}for(var b=0,a;a=g_chr_specs_by_class[c][b];b++){if(a==d){return c}}}return null};$WH.g_getRealStatIdForSpec=function(a,c,b){var d;var e;if(a==71){e=0;if(!b){return 5}while(1){d=c[e];if(d>=3){if(d<=5){break}}++e;if(e>=b){return 5}}}else{if(a!=72){if(a!=73){if(a!=74){return a}e=0;if(b){while(1){d=c[e];if(d>=4){if(d<=5){break}}++e;if(e>=b){return 5}}return d}return 5}e=0;if(b){while(1){d=c[e];if(c[e]==3){break}if(c[e]==5){break}++e;if(e>=b){return 5}}return d}return 5}e=0;if(!b){return 3}while(1){d=c[e];if(d>=3){if(d<=4){break}}++e;if(e>=b){return 3}}}return d};$WH.g_bonusesBtnShouldShow=function(b){for(var a in b){if(b.hasOwnProperty(a)){return true}}return false};$WH.g_bonusesBtnBuildMenu=function(e){var a=[[,LANG.selectbonus]];var o=e.bonusesData;if(o&&$WH.isset("g_itembonuses")){var k=[];for(var j in o){var m=o[j].groupedUpgrade;var n=$WH.g_getItemBonusName.call(this,j,e);var l=[j,n,$WH.g_bonusesBtnOnChange.bind(this,(m?"u:":"")+j,false)];if(typeof m=="undefined"){for(var d in o[j].sub){m=o[j].sub[d].groupedUpgrade;n=$WH.g_getItemBonusName.call(this,d,e,j);if(n=="???"){continue}var c=[d,n,$WH.g_bonusesBtnOnChange.bind(this,j+":"+(m?"u:":"")+d,false,true)];if(!l[MENU_IDX_SUB]){l[MENU_IDX_SUB]=[]}l[MENU_IDX_SUB].push(c)}}if(l[MENU_IDX_SUB]&&$WH.isset("g_itembonuses")){l[MENU_IDX_SUB].sort(function(q,p){var s=$WH.g_getItemBonusChanceType(q[MENU_IDX_ID]);var r=$WH.g_getItemBonusChanceType(p[MENU_IDX_ID]);return $WH.strcmp(s,r)||$WH.strcmp(q[MENU_IDX_NAME],p[MENU_IDX_NAME])});var h=[];var b=0;for(var f=0;f<l[MENU_IDX_SUB].length;++f){var d=l[MENU_IDX_SUB][f][MENU_IDX_ID];if(d&&o[j].sub[d].type!=b){b=o[j].sub[d].type;var g=LANG.unknown;switch(b){case 1:g=LANG.upgrades;break;case 2:g=LANG.su_note_stats;break;case 4:g=LANG.sockets;break;default:break}h.push([f,[,g]])}}for(var f=0;f<h.length;++f){l[MENU_IDX_SUB].splice(h[f][0]+f,0,h[f][1])}}k.push(l)}k.sort(function(r,p){var s=r[1].innerText?r[1].innerText:r[1];var q=p[1].innerText?p[1].innerText:p[1];return $WH.strcmp(s,q)});a=a.concat(k)}this._bonusesBtn.menu=a};$WH.g_getItemBonusChanceType=function(f){var e=0;if(f>0&&$WH.isset("g_itembonuses")&&g_itembonuses&&g_itembonuses[f]){var a=g_itembonuses[f];for(var c=0;c<a.length;++c){var b=a[c];var d=0;switch(b[0]){case 1:case 3:case 4:case 5:case 11:d=1;break;case 2:d=2;break;case 6:d=4;break;default:break}if(d&&(!e||d<e)){e=d}}}return e};$WH.g_getItemBonusUpgradeType=function(d){if(d>0&&$WH.isset("g_itembonuses")&&g_itembonuses&&g_itembonuses[d]){var a=g_itembonuses[d];for(var c=0;c<a.length;++c){var b=a[c];switch(b[0]){case 3:case 4:case 5:case 11:return 1<<b[0];default:break}}}return 0};$WH.g_getItemBonusName=function(d,l,e){var g="";var a=l.level;if(e&&$WH.isset("g_itembonuses")&&e>0&&g_itembonuses[e]){for(var c=0;c<g_itembonuses[e].length;++c){var j=g_itembonuses[e][c];if(j[0]==1){a+=j[1]}}}if($WH.isset("g_itembonuses")&&d>0&&g_itembonuses[d]){var b=g_itembonuses[d].slice();b.sort(function(n,m){return n[0]-m[0]});var f="";var k="";for(var c=0;c<b.length;++c){var j=b[c];switch(j[0]){case 1:f=LANG.itemlevel+" "+(a+j[1]);break;case 2:g+=(g?" / ":"")+(($WH.g_statToJson[j[1]]&&LANG.traits[$WH.g_statToJson[j[1]]])?LANG.traits[$WH.g_statToJson[j[1]]][1]:"Unknown stat");break;case 3:k=j[1];break;case 4:if($WH.isset("g_item_namedescriptions")&&g_item_namedescriptions[j[1]]){g+=(g?" / ":"")+g_item_namedescriptions[j[1]][0]}break;case 5:if($WH.isset("g_item_namedescriptions")&&g_item_namedescriptions[j[1]]){g=g_item_namedescriptions[j[1]][0]}break;case 6:var h=j[2];g+=(g?" / ":"")+j[1]+" "+(g_socket_names[h]||(g_gem_types[h]?$WH.sprintf(LANG.tooltip_emptyrelicslot.replace("%s","$1"),g_gem_types[h]):"Unknown Socket"));break;case 8:g+=(g?" / ":"")+$WH.sprintf(LANG.tooltip_reqlevel_format.replace("%s","$1"),l.reqlevel+j[1]);break;case 11:if(l.heirloombonuses){g+=(g?" / ":"")+$WH.sprintf(LANG.heirloomupgrade_format,(parseInt(d)==l.heirloombonuses[0])?1:2)}break;case 13:f=LANG.filters_spells.scaling;break;case 14:f=LANG.itemlevel+" "+j[1]+"+";break;default:break}}g+=(f?" / "+f:"")+((k&&l.quality!=k)?" / "+g_item_qualities[k]:"");if(g.substr(0,3)==" / "){g=g.substr(3)}}else{if(d=="0"){g=LANG.normal}}return g?g:(e?"???":LANG.normal)};$WH.g_bonusesBtnGetContextBonusId=function(c){var a=0;if(c&&c.length){for(var b=0;b<c.length;++b){if($WH.isset("g_itembonuses")&&g_itembonuses["-1"].indexOf(parseInt(c[b]))!=-1){a=c[b];break}}}return a};$WH.g_bonusesBtnIsComboValid=function(j,c,g){if(!j[c]||!j[c].sub){return false}var e=j[c].sub;var f=32768;var d=32768;for(var a in g){var h=g[a];if(h!=c){if(e[h]){if((f&e[h].type)==1){}else{if(f&e[h].type){f=false;break}else{f|=e[h].type}}if(d&e[h].upgradeType){d=false;break}else{d|=e[h].upgradeType}}else{f=false;break}}}return f&&d};$WH.g_bonusesBtnOnChange=function(H,T,c){var u=$WH.g_getDataSource();var C=this._bonusesBtn.ttId;var r=u[C].bonusesData;if(c===true){var P=H.split(":");var w=0;var q=P.indexOf("u");if(q!=-1){w=P[q+1];P.splice(q,1)}var h=P[0];var t=!Menu.findItem(this._bonusesBtn.menu,P).checked;var l=0;var o=[];$WH.array_walk(this._bonusesBtn.menu,function(j){if(j.checked){l=j[MENU_IDX_ID];if(j[MENU_IDX_SUB]){$WH.array_walk(j[MENU_IDX_SUB],function(Z){if(Z[MENU_IDX_ID]&&Z.checked){o.push(Z[MENU_IDX_ID]);if(l==h&&r[l].sub[Z[MENU_IDX_ID]].groupedUpgrade&&!w){w=Z[MENU_IDX_ID]}}})}}});var R;if(l==h){if(t){R=o.concat(P)}else{o.splice(o.indexOf(P[1]),1);R=o.concat([h])}}else{R=P}R.sort(function(Z,j){return Z-j});if(!$WH.g_bonusesBtnIsComboValid(r,h,R)){R=P;var y=r[h].sub[P[1]].type;var E=r[h].sub[P[1]].upgradeType;for(var U=0;U<o.length;++U){if(y!=r[h].sub[o[U]].type){R.push(o[U])}else{if(E!=r[h].sub[o[U]].upgradeType){R.push(o[U])}}}R.sort(function(Z,j){return Z-j})}if(w){var x=R.indexOf(w);if(x!=-1){R.splice(R.indexOf(w),0,"u")}}H=R.join(":").replace(/^0:/,"")}this._bonusesBtn.selectedBonus=H;var D=this._bonusesBtn.selectedBonus.split(":");var q=D.indexOf("u");if(q!=-1){D.splice(q,1)}$(this._bonusesBtn).html("");var J=$WH.g_bonusesBtnGetContextBonusId(D);$WH.array_walk(this._bonusesBtn.menu,function(j){j.checked=j[MENU_IDX_ID]==J;if(j[MENU_IDX_SUB]){$WH.array_walk(j[MENU_IDX_SUB],function(Z){if(Z[MENU_IDX_ID]){Z.checked=j.checked&&D.indexOf(Z[MENU_IDX_ID])!=-1;if(Z.$a){Z[MENU_IDX_OPT]=null;Menu.updateItem(Z)}}})}});var X=Menu.findItem(this._bonusesBtn.menu,[J]);if(X&&X[MENU_IDX_SUB]){$WH.array_walk(X[MENU_IDX_SUB],function(Z){if(Z[MENU_IDX_ID]){var j=D;if(D.indexOf(Z[MENU_IDX_ID])==-1){j=j.concat([Z[MENU_IDX_ID]])}j.sort(function(ab,aa){return ab-aa});if(!$WH.g_bonusesBtnIsComboValid(r,J,j)){Z[MENU_IDX_OPT]={"class":"q0"}}else{Z[MENU_IDX_OPT]={}}Menu.updateItem(Z)}})}var F=$WH.g_getItemBonusName.call(this,J,u[C]);for(var U=0;U<D.length;++U){if(D[U]!=J){F+=" + "+$WH.g_getItemBonusName.call(this,D[U],u[C],J)}}$(this._bonusesBtn).append(F);var p=0;if($WH.isset("g_itembonuses")&&g_items&&g_items[C]){for(var U in D){var n=D[U];if(g_itembonuses[n]){for(var S=0;S<g_itembonuses[n].length;++S){var v=g_itembonuses[n][S];if(v[0]==7&&g_items[C].appearances&&g_items[C].appearances[v[1]]){p=g_items[C].appearances[v[1]][0];break}}}}}var a=$("#d1c4b6d5a978ecb63b47c2e6a45e3389");if(a.length>0){var e="/upgrade?items=0;"+C;if(D.length>0){e+=Array(10).join(".0")+"."+D.join(".")}a.get(0).href=e}var k=$("#e8c7e052e3e0");if(k.length>0){var L=k.get(0).attributes.onclick.value;var O=new RegExp("\\(this, "+C+", \\[[^\\]]*?],");if(O.test(L)){var m=[];for(var f in D){var M=D[f];if(M==0){m.push(M);continue}var d=$WH.isset("g_itembonuses")&&g_itembonuses[M]?g_itembonuses[M]:[];for(var s in d){if(!d.hasOwnProperty(s)){continue}var Y=d[s][0];var B=d[s][1];if($WH.in_array([1,2,6,14],Y)!=-1){if(Y==2&&$WH.in_array([61,62,63,64,66],B)!=-1){continue}m.push(M)}}}k.get(0).attributes.onclick.value=L.replace(O,"(this, "+C+", ["+m.join(",")+"],")}}var W=$("#ic"+C);if(W.length>0&&g_items){var g=g_items.getIcon(C,D);if(g){W[0].removeChild(W[0].firstChild);W[0].appendChild(Icon.create(g,2))}}var b=$("#dsgndslgn464d");if(b.length>0){var K=b[0].attributes.onclick.value;if(!b[0]._defaultDisplayId){var O=new RegExp("displayId: (\\d+),","g");var A=O.exec(K);if(A){b[0]._defaultDisplayId=A[1]}}if(!p&&b[0]._defaultDisplayId){p=b[0]._defaultDisplayId}if(p){b[0].attributes.onclick.value=K.replace(/displayId: \d+/,"displayId: "+p)}}var G=$("#e8c6e055e3e0");if(G.length>0){var K=G[0].attributes.onclick.value;var V="";if(D.length>0){var I=[];while(I.length<9){I.push(0)}for(var U=0;U<D.length;++U){I.push(D[U])}V="."+I.join(".")}G[0].attributes.onclick.value=K.replace(/su_addToSaved\("?(\d+)[.\w]*"?, 1\)/,'su_addToSaved("$1'+V+'", 1)')}if(window.history){var z=this._bonusesBtn.selectedBonus.replace(/u:/,"");if(location.pathname.indexOf("&bonus")!=-1){window.history.replaceState({},"",location.pathname.replace(/&bonus=\d+(:\d+)*/,"&bonus="+z)+location.hash)}else{if(!location.hash){window.history.replaceState({},"",location.pathname+"&bonus="+z)}else{window.history.replaceState({},"",location.pathname+"&bonus="+z+location.hash)}}}$WH.updateItemStringLink.call(this);if(!T&&u[C]["tooltip_"+Locale.getName()]){var Q=$WH.ge("sl"+C);Q.innerHTML="";this.slider=null;var N=$WH.g_enhanceTooltip.call(this,C,true,true,Q,null,this._knownSpells,$WH.ge("ks"+C),this._selectedUpgrade,null,null,true,null,null,this._bonusesBtn.selectedBonus);$WH.updateTooltip.call(this,N)}};$WH.updateItemStringLink=function(){var h=$WH.g_getDataSource();var q=$WH.isset("g_pageInfo")?g_pageInfo.typeId:null;if(h[q]){var c="";var f=[];if(this._bonusesBtn&&this._bonusesBtn.selectedBonus){c=this._bonusesBtn.selectedBonus.replace(/u:/,"");f=c.split(":")}var l=(typeof this._selectedUpgrade=="number")?this._selectedUpgrade:0;var a=(h[q].upgradeData.length>0)?h[q].upgradeData[l].id:"";var p=this._selectedLevel?this._selectedLevel:$WH.g_max_level;var o=this._knowledgeLevel?this._knowledgeLevel:0;var n=(this._classSpecBtn&&this._classSpecBtn.selectedSpec)?this._classSpecBtn.selectedSpec:"";var k=0;var e="";if(a){k|=4;e=(e?":":"")+a}else{if(f.length&&g_itembonuses){bonus_check_block:for(var j=0,m;m=f[j];j++){if(!g_itembonuses[m]){continue}for(var b=0,g;g=g_itembonuses[m][b];b++){if(g[0]==11||g[0]==13){k|=512;e=(e?":":"")+p;break bonus_check_block}}}}}if(o){k|=8388608;e=(e?":":"")+(o+1)}var d=""+(k?k:"")+"::"+(f.length?f.length+":":"")+c+":"+e;$("#open-links-button").click(function(){this.blur();var r={type:3,typeId:q,linkColor:"ff"+g_items.getItemQualityColor(h[q].quality),linkId:"item:"+q+"::::::::"+p+":"+n+":"+d,linkName:h[q]["name_"+Locale.getName()],bonuses:f,slot:h[q].slot};if(p!=$WH.g_max_level){r.lvl=p}if(n){r.spec=n}Links.show(r)})}};$WH.g_upgradeItemTooltip=function(d,g){var c=$WH.g_getDataSource();var k=g_pageInfo.typeId;if(c[k]){var e=$("#"+d.id+" > input");var a=null;if(typeof g!="number"){e.each(function(l,m){if(m.id.indexOf(g)!=-1){a=m;return false}});if(a!=null&&g=="chal"){var j=c[k].level;e.each(function(l,m){if(m.id.indexOf("chal")==-1&&m.checked){j+=(m.id.indexOf("pvp")!=-1?c[k].pvpUpgrade:c[k].upgradeData[l+1])}});if(a.checked&&j<=$WH.g_applyStatModifications.ITEM_CHALLENGEMODE_LEVEL){a.checked=false;return}}}else{a=e.get(g-1)}var h=a.checked;e.each(function(l,m){m.checked=false});a.checked=h;if(!h){g=null}this._selectedUpgrade=g;$WH.updateItemStringLink.call(this);if(c[k]["tooltip_"+Locale.getName()]){var f=this._bonusesBtn&&this._bonusesBtn.selectedBonus?this._bonusesBtn.selectedBonus:null;var b=$WH.g_enhanceTooltip.call(this,k,true,true,false,null,this._knownSpells,$WH.ge("ks"+k),g,null,null,true,null,null,f);$WH.updateTooltip.call(this,b)}}};$WH.updateTooltip=function(a){this.innerHTML="<table><tr><td>"+a+'</td><th style="background-position: top right"></th></tr><tr><th style="background-position: bottom left"></th><th style="background-position: bottom right"></th></tr></table>';$WH.Tooltip.fixSafe(this,1,1)};$WH.g_staticTooltipLevelClick=function(b,a,j,l){while(b.className.indexOf("tooltip")==-1){b=b.parentNode}var k=b.innerHTML;k=k.match(/<!--i?\?(\d+):(\d+):(\d+):(\d+)/);if(!k){return}var m=parseInt(k[1]),e=parseInt(k[2]),h=parseInt(k[3]),d=parseInt(k[4]);if(e>=h){return}if(!a){a=prompt($WH.sprintf(LANG.prompt_ratinglevel,e,h),d)}a=parseInt(a);if(isNaN(a)){return}if(a==d||a<e||a>h){return}b._selectedLevel=a;var c=$WH.g_getDataSource();k=($WH.g_setTooltipLevel.bind(b,c[m][(l?"buff_":"tooltip_")+Locale.getName()],a,l))();var f=b._bonusesBtn&&b._bonusesBtn.selectedBonus?b._bonusesBtn.selectedBonus:null;var g=b._selectedUpgrade?b._selectedUpgrade:0;k=$WH.g_enhanceTooltip.call(b,k,true,null,null,null,null,null,g,null,null,null,null,null,f);$WH.updateTooltip.call(b,k);if(b.slider&&!j){Slider.setValue(b.slider,a)}if(!l){($WH.g_tooltipSpellsChange.bind(b))()}};$WH.g_staticTooltipKnowledgeLevelClick=function(h,g,d){while(h.className.indexOf("tooltip")==-1){h=h.parentNode}var c=h.innerHTML;if(!g){g=prompt($WH.sprintf(LANG.prompt_ratinglevel,0,g_artifact_knowledge_max_level),h._knowledgeLevel?h._knowledgeLevel:0)}g=parseInt(g);if(isNaN(g)){return}if(g<0||g>g_artifact_knowledge_max_level){return}h._knowledgeLevel=g;if(window.history){var b=g?"&artk="+g:"";if(location.pathname.indexOf("&artk=")!=-1){window.history.replaceState({},"",location.pathname.replace(/&artk=\d+/,b)+location.hash)}else{window.history.replaceState({},"",location.pathname+b+location.hash)}}var a=$WH.g_getDataSource();c=($WH.g_setTooltipLevel.bind(h,a[d]["tooltip_"+Locale.getName()],h._selectedLevel,null))();var f=h._bonusesBtn&&h._bonusesBtn.selectedBonus?h._bonusesBtn.selectedBonus:null;var e=h._selectedUpgrade?h._selectedUpgrade:0;c=$WH.g_enhanceTooltip.call(h,c,true,null,null,null,null,null,e,null,null,null,null,null,f);$WH.updateTooltip.call(h,c)};$WH.g_tooltipSliderMove=function(c,b,a){$WH.g_staticTooltipLevelClick(this,a.value,1);if(this.bufftip){$WH.g_staticTooltipLevelClick(this.bufftip,a.value,1,1)}$WH.Tooltip.hide()};$WH.g_tooltipSpellsChange=function(){if(!this.modified){return}var c=this.modified[0],a=this.modified[1],b=[];$.each($("input:checked",c),function(d,e){b.push(parseInt(e.id.replace("known-","")))});this.modified[2]=b;this.innerHTML=$WH.g_setTooltipSpells(this.innerHTML,b,a);if(this.bufftip){($WH.g_tooltipSpellsChange.bind(this.bufftip))()}};$WH.g_tooltipRPPMChange=function(a){var b=$(this).attr("id").match(/\d+$/)[0];a.innerHTML=a.innerHTML.replace(/<!--rppm-->(\[?)(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(c,f,e,d){return"<!--rppm-->"+f+(a._rppmModBase*(1+parseFloat(a._rppmSpecModList[b].modifiervalue))).toFixed(2)+d+"<!--rppm-->"})};$WH.g_validateBpet=function(k,b){var g=1,l=25,j=25,a=0,d=4,c=3,h=(1<<10)-1,f=3,e=$.extend({},b);if(k.minlevel){g=k.minlevel}if(k.maxlevel){l=k.maxlevel}if(k.companion){l=g}if(!e.level){e.level=j}e.level=Math.min(Math.max(e.level,g),l);if(k.minquality){a=k.minquality;if(k.untameable){d=a}}if(k.maxquality){d=k.maxquality}if(e.quality==null){e.quality=c}e.quality=Math.min(Math.max(e.quality,a),d);if(k.companion){delete (e.quality)}if(k.breeds>0){h=k.breeds&h}if(!(h&(1<<f-3))){f=Math.floor(3+Math.log(h)/Math.LN2)}if(e.breed&&e.breed>=13){e.breed-=10}if(!e.breed||!(h&(1<<e.breed-3))){e.breed=f}return e};$WH.g_calcBattlePetStats=function(a,e,k,c,d){if(!$WH.g_battlePetBreedStats[e]){e=3}var h=a.health;if(isNaN(h)){h=0}var b=a.power;if(isNaN(b)){b=0}var g=a.speed;if(isNaN(g)){g=0}if(isNaN(k)){k=1}k=Math.min(Math.max(0,k),5);if(isNaN(c)){c=1}c=Math.min(Math.max(1,c),25);var f=$WH.g_battlePetBreedStats[e];var j=1+(k/10);h=((h+f[0])*5*c*j)+100;b=(b+f[1])*c*j;g=(g+f[2])*c*j;if(d){h=h*5/6;b=b*4/5}return{health:Math.round(h),power:Math.round(b),speed:Math.round(g)}};$WH.g_battlePetBreedStats={3:[0.5,0.5,0.5],4:[0,2,0],5:[0,0,2],6:[2,0,0],7:[0.9,0.9,0],8:[0,0.9,0.9],9:[0.9,0,0.9],10:[0.4,0.9,0.4],11:[0.4,0.4,0.9],12:[0.9,0.4,0.4]};$WH.g_battlePetAbilityLevels=[1,2,4,10,15,20];$WH.g_getCharCustomizationVariations=function(F,k,O,s){var B=[[],[],[]];if($WH.isset("g_charCustomizations")&&g_charCustomizations){if(!$WH.g_charCustomizationsLookup){$WH.g_charCustomizationsLookup={};for(var M=0;M<g_charCustomizations.length;++M){var p=g_charCustomizations[M];var e=p[0];var a=p[1];var Q=p[2];var n=p[3];var x=p[4];var H=p[5];if(!$WH.g_charCustomizationsLookup[e]){$WH.g_charCustomizationsLookup[e]={}}if(!$WH.g_charCustomizationsLookup[e][a]){$WH.g_charCustomizationsLookup[e][a]={}}if(!$WH.g_charCustomizationsLookup[e][a][Q]){$WH.g_charCustomizationsLookup[e][a][Q]={}}var q=(n&4);var L=(n&16);var t=(n&32);var K=q||L;var I=t||L;if(!q&&!t){if(!$WH.g_charCustomizationsLookup[e][a][Q]["1"]){$WH.g_charCustomizationsLookup[e][a][Q]["1"]={}}if(!$WH.g_charCustomizationsLookup[e][a][Q]["1"].hasOwnProperty(x)){$WH.g_charCustomizationsLookup[e][a][Q]["1"][x]=[]}if($WH.in_array($WH.g_charCustomizationsLookup[e][a][Q]["1"][x],H)==-1){$WH.g_charCustomizationsLookup[e][a][Q]["1"][x].push(H)}}if(K){if(!$WH.g_charCustomizationsLookup[e][a][Q]["2"]){$WH.g_charCustomizationsLookup[e][a][Q]["2"]={}}if(!$WH.g_charCustomizationsLookup[e][a][Q]["2"].hasOwnProperty(x)){$WH.g_charCustomizationsLookup[e][a][Q]["2"][x]=[]}if($WH.in_array($WH.g_charCustomizationsLookup[e][a][Q]["2"][x],H)==-1){$WH.g_charCustomizationsLookup[e][a][Q]["2"][x].push(H)}}if(I){if(!$WH.g_charCustomizationsLookup[e][a][Q]["3"]){$WH.g_charCustomizationsLookup[e][a][Q]["3"]={}}if(!$WH.g_charCustomizationsLookup[e][a][Q]["3"].hasOwnProperty(x)){$WH.g_charCustomizationsLookup[e][a][Q]["3"][x]=[]}if($WH.in_array($WH.g_charCustomizationsLookup[e][a][Q]["3"][x],H)==-1){$WH.g_charCustomizationsLookup[e][a][Q]["3"][x].push(H)}}}if($WH.isset("g_charFeatures")&&g_charFeatures){var J={};for(var M=0;M<g_charFeatures.length;++M){var f=g_charFeatures[M];var u=f[0];var d=f[1];var G=f[2];if(!J[u]){J[u]={}}if(!J[u][d]){J[u][d]=[]}J[u][d].push(G)}var g={"5":7,"0":2};for(var u in J){for(var d in J[u]){if($WH.g_charCustomizationsLookup[u]&&$WH.g_charCustomizationsLookup[u][d]){J[u][d].sort();for(var c in g){if(!$WH.g_charCustomizationsLookup[u][d].hasOwnProperty(c)){continue}if($WH.g_charCustomizationsLookup[u][d].hasOwnProperty(g[c])){continue}$WH.g_charCustomizationsLookup[u][d][g[c]]={};for(var m in $WH.g_charCustomizationsLookup[u][d][c]){$WH.g_charCustomizationsLookup[u][d][g[c]][m]={};for(var o in $WH.g_charCustomizationsLookup[u][d][c][m]){for(var E=0;E<J[u][d].length;E++){var b=J[u][d][E];if(!$WH.g_charCustomizationsLookup[u][d][g[c]][m].hasOwnProperty(b)){$WH.g_charCustomizationsLookup[u][d][g[c]][m][b]=[]}$WH.g_charCustomizationsLookup[u][d][g[c]][m][b]=$WH.array_unique($WH.g_charCustomizationsLookup[u][d][g[c]][m][b].concat($WH.g_charCustomizationsLookup[u][d][c][m][o]))}}}}}}}}if($WH.isset("g_barberStyleNames")&&g_barberStyleNames){$WH.g_barberStyleNamesLookup={};for(var M=0;M<g_barberStyleNames.length;++M){var D=g_barberStyleNames[M];var l=D[0];var v=D[1];var P=D[2];var j=D[3];var A=D[4];if(!$WH.g_barberStyleNamesLookup[v]){$WH.g_barberStyleNamesLookup[v]={}}if(!$WH.g_barberStyleNamesLookup[v][P]){$WH.g_barberStyleNamesLookup[v][P]={}}if(!$WH.g_barberStyleNamesLookup[v][P][l]){$WH.g_barberStyleNamesLookup[v][P][l]={}}$WH.g_barberStyleNamesLookup[v][P][l][j]=A}}}var r="1";switch(parseInt(O)){case 6:r="2";break;case 12:r="3";break}var w=[k,k==1?0:1];charAppearanceLoops:for(var N in w){var C=w[N];if($WH.g_charCustomizationsLookup[F]&&$WH.g_charCustomizationsLookup[F][C]){for(var h in s){var y=s[h];if($WH.g_charCustomizationsLookup[F][C][y]&&$WH.g_charCustomizationsLookup[F][C][y][r]){B=$WH.g_charCustomizationsLookup[F][C][y][r];break charAppearanceLoops}}}}}return B};$WH.Tooltip={showingTooltip:false,create:function(j,l){var g=$WH.ce("div"),n=$WH.ce("table"),b=$WH.ce("tbody"),f=$WH.ce("tr"),c=$WH.ce("tr"),a=$WH.ce("td"),m=$WH.ce("th"),k=$WH.ce("th"),h=$WH.ce("th");g.className="wowhead-tooltip";m.style.backgroundPosition="top right";k.style.backgroundPosition="bottom left";h.style.backgroundPosition="bottom right";if(j){a.innerHTML=j}$WH.ae(f,a);$WH.ae(f,m);$WH.ae(b,f);$WH.ae(c,k);$WH.ae(c,h);$WH.ae(b,c);$WH.ae(n,b);if(!l){$WH.Tooltip.icon=$WH.ce("p");$WH.Tooltip.icon.style.visibility="hidden";$WH.ae($WH.Tooltip.icon,$WH.ce("div"));$WH.ae(g,$WH.Tooltip.icon)}$WH.ae(g,n);if(!l){var e=$WH.ce("div");e.className="wowhead-tooltip-powered";$WH.ae(g,e);$WH.Tooltip.logo=e}return g},getMultiPartHtml:function(b,a){return"<table><tr><td>"+b+"</td></tr></table><table><tr><td>"+a+"</td></tr></table>"},fix:function(j,b,e){var k=$WH.gE(j,"table")[0],f=$WH.gE(k,"td")[0],h=f.childNodes;j.className=$WH.trim(j.className.replace("tooltip-slider",""));if(h.length>=2&&h[0].nodeName=="TABLE"&&h[1].nodeName=="TABLE"){h[0].style.whiteSpace="nowrap";var d=parseInt(j.style.width);if(!j.slider||!d){if(h[1].offsetWidth==0){d=320}else{if(h[1].offsetWidth>300){d=Math.max(300,h[0].offsetWidth)+20}else{d=Math.max(h[0].offsetWidth,h[1].offsetWidth)+20}}}for(var g=2;g<h.length;g++){if(h[g].nodeName=="BLOCKQUOTE"){d=Math.max(d,h[g].offsetWidth+20)}}d=Math.min(320,d);if(d>20){j.className+=" wowhead-tooltip-width-restriction wowhead-tooltip-width-"+d;j.style.width=d+"px";h[0].style.width=h[1].style.width="100%";if(j.slider){Slider.setSize(j.slider,d-6);j.className+=" tooltip-slider"}if(!b&&j.offsetHeight>document.body.clientHeight){k.className="shrink"}}}else{if(h.length>=1&&j.slider){var a=h[0].nodeName=="TABLE";if(a){h[0].style.whiteSpace="nowrap"}var d=parseInt(j.style.width);if(!d&&a){d=h[0].offsetWidth+20}else{d=k.offsetWidth+20}d=Math.min(320,d);if(d>20){j.style.width=d+"px";if(a){h[0].style.width="100%"}if(j.slider){Slider.setSize(j.slider,d-6);j.className+=" tooltip-slider"}if(!b&&j.offsetHeight>document.body.clientHeight){k.className="shrink"}}}}if(e){$WH.Tooltip.setTooltipVisibility(j,true)}},fixSafe:function(c,b,a){$WH.Tooltip.fix(c,b,a)},attachImage:function(d,e,k,h){if(typeof h=="undefined"){h=""}if(typeof jQuery!="undefined"){jQuery(d.parentNode).children(".image"+h).remove()}else{var l=new RegExp("\\bimage"+h+"\\b");for(var g=0;g<d.parentNode.childNodes.length;g++){if(l.test(d.parentNode.childNodes[g].className)){d.parentNode.removeChild(d.parentNode.childNodes[g]);g--}}}var j=typeof e;if(j=="number"){var f=$WH.g_getDataSource(),b=e;if(f[b]&&f[b]["image_"+Locale.getName()+h]){e=f[b]["image_"+Locale.getName()+h]}else{return}}else{if(j!="string"){return}}var a=$WH.ce("div");a.className="image"+h+(k?" "+k:"");a.style.backgroundImage="url("+e+")";if(typeof jQuery!="undefined"){jQuery(d).after(a)}else{d.parentNode.insertBefore(a,d.nextSibling)}},append:function(e,b,f,d){var e=$WH.ge(e);var a=$WH.Tooltip.create(b,f);if(d){var c=$WH.ce("p");c.style.backgroundImage="url("+$WH.staticUrl+"/images/wow/icons/medium/"+d.toLowerCase()+".jpg)";$WH.ae(c,$WH.ce("div"));$WH.ae(a,c)}$WH.ae(e,a);$WH.Tooltip.fixSafe(a,1,1)},reset:function(){if($WH.Tooltip.tooltip){$WH.Tooltip.tooltip.parentNode.removeChild($WH.Tooltip.tooltip);$WH.Tooltip.tooltip=null}if($WH.Tooltip.tooltip2){$WH.Tooltip.tooltip2.parentNode.removeChild($WH.Tooltip.tooltip2);$WH.Tooltip.tooltip2=null}},prepare:function(c){if($WH.Tooltip.tooltip){return}var a=(typeof c!="undefined")?c:document.body;var b=$WH.Tooltip.create();b.style.position="absolute";b.style.left=b.style.top="-2323px";$WH.ae(a,b);$WH.Tooltip.tooltip=b;$WH.Tooltip.tooltipTable=$WH.gE(b,"table")[0];$WH.Tooltip.tooltipTd=$WH.gE(b,"td")[0];var b=$WH.Tooltip.create(null,true);b.style.position="absolute";b.style.left=b.style.top="-2323px";$WH.ae(a,b);$WH.Tooltip.tooltip2=b;$WH.Tooltip.tooltipTable2=$WH.gE(b,"table")[0];$WH.Tooltip.tooltipTd2=$WH.gE(b,"td")[0]},prepareScreen:function(){if($WH.Tooltip.screen){$WH.Tooltip.screen.style.display="block"}else{$WH.Tooltip.screen=$WH.ce("div",{id:"wowhead-tooltip-screen",className:"wowhead-tooltip-screen"});$WH.Tooltip.screenCloser=$WH.ce("a",{id:"wowhead-tooltip-screen-close",className:"wowhead-tooltip-screen-close",onclick:$WowheadPower.clearTouchTooltip});$WH.Tooltip.screenInnerWrapper=$WH.ce("div",{id:"wowhead-tooltip-screen-inner-wrapper",className:"wowhead-tooltip-screen-inner-wrapper"});$WH.Tooltip.screenInner=$WH.ce("div",{id:"wowhead-tooltip-screen-inner",className:"wowhead-tooltip-screen-inner"});$WH.Tooltip.screenInnerBox=$WH.ce("div",{id:"wowhead-tooltip-screen-inner-box",className:"wowhead-tooltip-screen-inner-box"});$WH.Tooltip.screenCaption=$WH.ce("div",{id:"wowhead-tooltip-screen-caption",className:"wowhead-tooltip-screen-caption"});$WH.ae($WH.Tooltip.screen,$WH.Tooltip.screenCloser);$WH.ae($WH.Tooltip.screenInner,$WH.Tooltip.screenInnerBox);$WH.ae($WH.Tooltip.screenInnerWrapper,$WH.Tooltip.screenInner);$WH.ae($WH.Tooltip.screen,$WH.Tooltip.screenInnerWrapper);$WH.ae($WH.Tooltip.screen,$WH.Tooltip.screenCaption);$WH.ae(document.body,$WH.Tooltip.screen)}$WH.Tooltip.mobileTooltipShown=true;$WH.Tooltip.setupIScroll()},destroyIScroll:function(){if($WH.Tooltip.iScroll){$WH.Tooltip.iScroll.destroy();$WH.Tooltip.iScroll=null}},setupIScroll:function(){if(!$WH.Tooltip.mobileScrollSetUp){var a=function(b){if($WH.Tooltip.mobileTooltipShown){if(!document.getElementById("wowhead-tooltip-screen-inner").contains(b.target)){b.preventDefault()}}};$WH.aE(document.body,"touchmove",a);$WH.aE(document.body,"mousewheel",a);$WH.Tooltip.mobileScrollSetUp=true}if(typeof IScroll!="function"){return}setTimeout(function(){$WH.Tooltip.destroyIScroll();$WH.Tooltip.iScroll=new IScroll($WH.Tooltip.screenInnerWrapper,{mouseWheel:true,tap:true})},1)},setTooltipVisibility:function(a,b){if(b){a.setAttribute("data-visible","yes");a.style.visibility="visible"}else{a.setAttribute("data-visible","no");a.style.visibility="hidden"}},set:function(g,d,f,c){var b=$WH.Tooltip.tooltip;b.style.width="550px";b.style.left="-2323px";b.style.top="-2323px";$WH.Tooltip.tooltip.className="wowhead-tooltip";if(g.nodeName){$WH.ee($WH.Tooltip.tooltipTd);$WH.ae($WH.Tooltip.tooltipTd,g)}else{$WH.Tooltip.tooltipTd.innerHTML=g}b.style.display="";$WH.Tooltip.setTooltipVisibility(b,true);$WH.Tooltip.fix(b,0,0);if(d){$WH.Tooltip.showSecondary=true;var b=$WH.Tooltip.tooltip2;b.style.width="550px";b.style.left="-2323px";b.style.top="-2323px";if(d.nodeName){$WH.ee($WH.Tooltip.tooltipTd2);$WH.ae($WH.Tooltip.tooltipTd2,d)}else{$WH.Tooltip.tooltipTd2.innerHTML=d}b.style.display="";$WH.Tooltip.fix(b,0,0)}else{$WH.Tooltip.showSecondary=false}var a=typeof Platform!="undefined"?Platform.isTouch():$WH.isTouch();if(a){var h=$WH.Tooltip.showSecondary?$WH.Tooltip.tooltipTd2:$WH.Tooltip.tooltipTd;var e=$WH.ce("a");e.href="javascript:;";e.className="wowhead-touch-tooltip-closer";e.onclick=$WowheadPower.clearTouchTooltip;$WH.ae(h,e)}$WH.Tooltip.tooltipTable.style.display=(g=="")?"none":"";$WH.Tooltip.attachImage($WH.Tooltip.tooltipTable,f,c);$WH.Tooltip.generateEvent("show")},displayTooltip:function(a,d,b,c){$WowheadPower.displayTooltip(a,d,b,c)},moveTests:[[null,null],[null,false],[false,null],[false,false]],move:function(p,o,e,q,d,b){if(!$WH.Tooltip.tooltipTable){return}var n=$WH.Tooltip.tooltip,j=$WH.Tooltip.tooltipTable.offsetWidth,c=$WH.Tooltip.tooltipTable.offsetHeight,l=$WH.Tooltip.tooltip2,g=$WH.Tooltip.showSecondary?$WH.Tooltip.tooltipTable2.offsetWidth:0,a=$WH.Tooltip.showSecondary?$WH.Tooltip.tooltipTable2.offsetHeight:0,r;n.style.width=(j==0)?"auto":(j+"px");l.style.width=g+"px";var m,f;for(var h=0,k=$WH.Tooltip.moveTests.length;h<k;++h){r=$WH.Tooltip.moveTests[h];m=$WH.Tooltip.moveTest(p,o,e,q,d,b,r[0],r[1]);if($WH.isset("WAS")&&!WAS.intersect(m)){f=true;break}else{if(!$WH.isset("WAS")){break}}}if($WH.isset("WAS")&&!f){WAS.intersect(m,true)}n.style.left=m.l+"px";n.style.top=m.t+"px";$WH.Tooltip.setTooltipVisibility(n,true);if($WH.Tooltip.showSecondary){l.style.left=m.l+j+"px";l.style.top=m.t+"px";$WH.Tooltip.setTooltipVisibility(l,true)}$WH.Tooltip.generateEvent("move")},moveTest:function(e,n,q,A,c,a,p,b){var m=e,y=n,g=$WH.Tooltip.tooltip,k=$WH.Tooltip.tooltipTable.offsetWidth,s=$WH.Tooltip.tooltipTable.offsetHeight,o=$WH.Tooltip.tooltip2,z=$WH.Tooltip.showSecondary?$WH.Tooltip.tooltipTable2.offsetWidth:0,f=$WH.Tooltip.showSecondary?$WH.Tooltip.tooltipTable2.offsetHeight:0,j=$WH.g_getWindowSize(),l=$WH.g_getScroll(),h=j.w,r=j.h,d=l.x,x=l.y,w=d,v=x,u=d+h,t=x+r;if(p==null){p=(e+q+k+z<=u)}if(b==null){b=(n-Math.max(s,f)>=v)}if(p){e+=q+c}else{e=Math.max(e-(k+z),w)-c}if(b){n-=Math.max(s,f)+a}else{n+=A+a}if(e<w){e=w}else{if(e+k+z>u){e=u-(k+z)}}if(n<v){n=v}else{if(n+Math.max(s,f)>t){n=Math.max(x,t-Math.max(s,f))}}if($WH.Tooltip.iconVisible){if(m>=e-48&&m<=e&&y>=n-4&&y<=n+48){n-=48-(y-n)}}return $WH.g_createRect(e,n,k,s)},show:function(e,h,b,a,f,c,d,g){if($WH.Tooltip.disabled){return}if(!b||b<1){b=1}if(!a||a<1){a=1}if(f){h='<span class="'+f+'">'+h+"</span>"}var j=$WH.ac(e);$WH.Tooltip.prepare();$WH.Tooltip.set(h,c,d,g);$WH.Tooltip.move(j.x,j.y,e.offsetWidth,e.offsetHeight,b,a)},showAtCursor:function(f,k,b,a,g,c,d,j){if($WH.Tooltip.disabled){return}if(!b||b<10){b=10}if(!a||a<10){a=10}if(g){k='<span class="'+g+'">'+k+"</span>";if(c){c='<span class="'+g+'">'+c+"</span>"}}f=$WH.$E(f);var h=$WH.g_getCursorPos(f);$WH.Tooltip.prepare();$WH.Tooltip.set(k,c,d,j);$WH.Tooltip.move(h.x,h.y,0,0,b,a)},showAtXY:function(g,a,h,d,c,e,f,b){if($WH.Tooltip.disabled){return}$WH.Tooltip.prepare();$WH.Tooltip.set(g,e,f,b);$WH.Tooltip.move(a,h,0,0,d,c)},showInScreen:function(d,k,e,b,c,j,f){$WowheadPower.clearTouchTooltip(true);if($WH.Tooltip.disabled){return}if(e){k='<span class="'+e+'">'+k+"</span>"}$WH.Tooltip.prepareScreen();$WH.ee($WH.Tooltip.screenCaption);var h=$WH.ce("a",{innerHTML:$WH.g_isRemote()?"Tap Link":LANG.tooltip_taplink,onclick:(function(a,l){a.setAttribute("data-disable-wowhead-tooltip","true");if(a.fireEvent){a.fireEvent("on"+l)}else{if(typeof MouseEvent=="function"){a.dispatchEvent(new MouseEvent(l,{bubbles:true,cancelable:true}))}else{var m=document.createEvent("Events");m.initEvent(l,true,true);a.dispatchEvent(m)}}if(a){a.removeAttribute("data-disable-wowhead-tooltip")}$WowheadPower.clearTouchTooltip()}).bind(null,d,"click")});var g=$WH.ce("i",{className:"fa fa-hand-o-up"});$WH.aef(h,g);$WH.ae($WH.Tooltip.screenCaption,h);$WowheadPower.setParent($WH.Tooltip.screenInnerBox);$WH.Tooltip.setIcon(f);$WH.Tooltip.set(k,b,c,j);$WH.Tooltip.move()},cursorUpdate:function(b,a,d){if($WH.Tooltip.disabled||!$WH.Tooltip.tooltip){return}b=$WH.$E(b);if(!a||a<10){a=10}if(!d||d<10){d=10}var c=$WH.g_getCursorPos(b);$WH.Tooltip.move(c.x,c.y,0,0,a,d)},hide:function(){$WH.Tooltip.showingTooltip=false;if($WH.Tooltip.tooltip){$WH.Tooltip.tooltip.style.display="none";$WH.Tooltip.setTooltipVisibility($WH.Tooltip.tooltip,false);$WH.Tooltip.tooltipTable.className="";$WH.Tooltip.setIcon(null);if($WH.isset("WAS")){WAS.restoreHidden()}$WH.Tooltip.generateEvent("hide")}if($WH.Tooltip.tooltip2){$WH.Tooltip.tooltip2.style.display="none";$WH.Tooltip.setTooltipVisibility($WH.Tooltip.tooltip2,false);$WH.Tooltip.tooltipTable2.className=""}},setIcon:function(a){$WH.Tooltip.prepare();if(a){$WH.Tooltip.icon.style.backgroundImage="url("+$WH.staticUrl+"/images/wow/icons/medium/"+a.toLowerCase()+".jpg)";$WH.Tooltip.icon.style.visibility="visible"}else{$WH.Tooltip.icon.style.backgroundImage="none";$WH.Tooltip.icon.style.visibility="hidden"}$WH.Tooltip.iconVisible=a?1:0},generateEvent:function(a){if(!$WH.Tooltip.tooltip){return}try{$WH.Tooltip.tooltip.dispatchEvent(new Event(a))}catch(c){try{var b=document.createEvent("Event");b.initEvent(a,true,true);$WH.Tooltip.tooltip.dispatchEvent(b)}catch(c){void (0)}}},addTooltipText:function(c,d,b){var a=b?' class="'+b+'"':"";c._fixTooltip=function(e){var f=/<\/table>\s*$/;if(f.test(e)){return e.replace(f,'<tr><td colspan="2"><div'+a+' style="margin-top:10px">'+d+"</div></td></tr></table>")}else{return e+"<div"+a+' style="margin-top:10px">'+d+"</div>"}}},simple:function(b,c,a,d){if(d){b.onmouseover=function(f){$WH.Tooltip.show(b,c,false,false,a)}}else{b.onmouseover=function(f){$WH.Tooltip.showAtCursor(f,c,false,false,a)};b.onmousemove=$WH.Tooltip.cursorUpdate}b.onmouseout=$WH.Tooltip.hide},simpleOverride:function(c,e,b,g,j,f,k,d,l,a,h){c.overrideTooltip={html:e,htmlGenerator:b,spanClass:g,icon:j,html2:f,html2Generator:k,image:d,imageClass:l,map:a,spellData:h}}};$WH.g_createButton=function(n,d,k){var b="btn btn-site";var g="";var f="";var e="";var o="";var h=[];var m=[];if(!k){k={}}if(!k["no-margin"]){m.push("margin-left:5px")}if(typeof d!="string"||d===""){d="javascript:;"}if(k["new-window"]){g=' target="_blank"'}if(typeof k.id=="string"){f=' id="'+k.id+'"'}if(typeof k.size!="undefined"){switch(k.size){case"small":case"large":h.push("btn-"+k.size);break}}else{h.push("btn-small")}if(typeof k["class"]=="string"){h.push(k["class"])}if(typeof k.type=="string"){switch(k.type){case"default":case"gray":b="btn";break;default:b="btn btn-"+k.type}}if(k.disabled){h.push("btn-disabled");d="javascript:;"}if(h.length){b+=" "+h.join(" ")}if(b){b=' class="'+b+'"'}if(!(typeof k["float"]!="undefined"&&!k["float"])){m.push("float:right")}if(typeof k.style=="string"){m.push(k.style)}if(m.length){e=' style="'+m.join(";")+'"'}var j='<a href="'+d+'"'+g+f+b+e+">"+(n||"")+"</a>";var c=$WH.ce("div");c.innerHTML=j;var l=c.childNodes[0];if(typeof k.click=="function"&&!k.disabled){l.onclick=k.click}if(typeof k.tooltip!="undefined"){if(k.tooltip!==false){l.setAttribute("data-whattach","true")}if(k.tooltip===false){l.rel="np"}else{if(typeof k.tooltip=="string"){$WH.Tooltip.simple(l,k.tooltip,null,true)}else{if(typeof k.tooltip=="object"&&k.tooltip["text"]){$WH.Tooltip.simple(l,k.tooltip["text"],k.tooltip["class"],true)}}}}return l};if($WH.isset("$WowheadPower")){$WowheadPower.init()};